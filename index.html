<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini Skills Booster - Themed & Dynamic UI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/lucide-static@latest/dist/lucide.min.js"></script>

    <style>
        :root {
            /* Dark Mode Variables (Default) */
            --dm-primary-bg: #03060A;
            --dm-secondary-bg: #080B10;
            --dm-tertiary-bg: #10141B;
            --dm-accent-cyan: #00CFDE;
            --dm-accent-cyan-hover: #00F0FF;
            --dm-accent-cyan-glow: rgba(0, 207, 222, 0.25);
            --dm-accent-magenta: #F02D8E;
            --dm-accent-magenta-hover: #FF4AA1;
            --dm-accent-magenta-glow: rgba(240, 45, 142, 0.2);
            --dm-accent-green: #3EFF9A;
            --dm-accent-green-hover: #6BFFB8;
            --dm-accent-red: #FF4F4F;
            --dm-accent-red-hover: #FF7272;
            --dm-text-primary: #F0F8FF; /* Alice Blue - very light */
            --dm-text-secondary: #A0B0C0;
            --dm-text-interactive: var(--dm-accent-cyan-hover);
            --dm-border-color: #1D232C;
            --dm-card-shadow: rgba(0, 0, 0, 0.6);
            --dm-aurora-opacity: 0.07;

            /* Light Mode Variables */
            --lm-primary-bg: #F8F9FA; /* Very light gray */
            --lm-secondary-bg: #FFFFFF; 
            --lm-tertiary-bg: #E9ECEF; /* Light gray for cards/hovers */
            --lm-accent-cyan: #007BFF; /* Standard blue */
            --lm-accent-cyan-hover: #0056b3;
            --lm-accent-cyan-glow: rgba(0, 123, 255, 0.15);
            --lm-accent-magenta: #D81B60; /* Strong pink */
            --lm-accent-magenta-hover: #C2185B;
            --lm-accent-magenta-glow: rgba(216, 27, 96, 0.1);
            --lm-accent-green: #28A745; /* Standard green */
            --lm-accent-green-hover: #218838;
            --lm-accent-red: #DC3545; /* Standard red */
            --lm-accent-red-hover: #C82333;
            --lm-text-primary: #212529; /* Dark gray for text */
            --lm-text-secondary: #495057;
            --lm-text-interactive: var(--lm-accent-cyan);
            --lm-border-color: #DEE2E6; /* Light border */
            --lm-card-shadow: rgba(0, 0, 0, 0.1);
            --lm-aurora-opacity: 0.03; /* Even more subtle for light mode */

            /* Applied Variables (default to dark mode) */
            --primary-bg: var(--dm-primary-bg);
            --secondary-bg: var(--dm-secondary-bg);
            --tertiary-bg: var(--dm-tertiary-bg);
            --accent-cyan: var(--dm-accent-cyan);
            --accent-cyan-hover: var(--dm-accent-cyan-hover);
            --accent-cyan-glow: var(--dm-accent-cyan-glow);
            --accent-magenta: var(--dm-accent-magenta);
            --accent-magenta-hover: var(--dm-accent-magenta-hover);
            --accent-magenta-glow: var(--dm-accent-magenta-glow);
            --accent-green: var(--dm-accent-green);
            --accent-green-hover: var(--dm-accent-green-hover);
            --accent-red: var(--dm-accent-red);
            --accent-red-hover: var(--dm-accent-red-hover);
            --text-primary: var(--dm-text-primary);
            --text-secondary: var(--dm-text-secondary);
            --text-interactive: var(--dm-text-interactive);
            --border-color: var(--dm-border-color);
            --card-shadow: var(--dm-card-shadow);
            --aurora-opacity: var(--dm-aurora-opacity);
             /* Aurora colors are consistent, only opacity changes */
            --aurora-1: #00CFDE; 
            --aurora-2: #F02D8E;
            --aurora-3: #FFB300;
            --aurora-4: #7C4DFF;
        }

        body.light-mode {
            --primary-bg: var(--lm-primary-bg);
            --secondary-bg: var(--lm-secondary-bg);
            --tertiary-bg: var(--lm-tertiary-bg);
            --accent-cyan: var(--lm-accent-cyan);
            --accent-cyan-hover: var(--lm-accent-cyan-hover);
            --accent-cyan-glow: var(--lm-accent-cyan-glow);
            --accent-magenta: var(--lm-accent-magenta);
            --accent-magenta-hover: var(--lm-accent-magenta-hover);
            --accent-magenta-glow: var(--lm-accent-magenta-glow);
            --accent-green: var(--lm-accent-green);
            --accent-green-hover: var(--lm-accent-green-hover);
            --accent-red: var(--lm-accent-red);
            --accent-red-hover: var(--lm-accent-red-hover);
            --text-primary: var(--lm-text-primary);
            --text-secondary: var(--lm-text-secondary);
            --text-interactive: var(--lm-text-interactive);
            --border-color: var(--lm-border-color);
            --card-shadow: var(--lm-card-shadow);
            --aurora-opacity: var(--lm-aurora-opacity);
        }


        @keyframes animatedAuroraBackground { /* Unchanged */
            0% { background-position: 0% 0%; transform: scale(1); }
            25% { background-position: 100% 0%; transform: scale(1.05); }
            50% { background-position: 100% 100%; transform: scale(1); }
            75% { background-position: 0% 100%; transform: scale(1.05); }
            100% { background-position: 0% 0%; transform: scale(1); }
        }
        @keyframes textShine { /* Unchanged */
            0% { background-position: -200% center; }
            100% { background-position: 200% center; }
        }
        @keyframes subtleFloat { /* Unchanged */
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }
        @keyframes fadeInSlideUp { /* Unchanged */
            from { opacity: 0; transform: translateY(40px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes pop { /* Unchanged */
            0% { transform: scale(0.3); opacity: 0; }
            70% { transform: scale(1.15); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        @keyframes tada { /* Unchanged */
            0% {transform: scale(1);} 10%, 20% {transform: scale(0.9) rotate(-3deg);}
            30%, 50%, 70%, 90% {transform: scale(1.1) rotate(3deg);}
            40%, 60%, 80% {transform: scale(1.1) rotate(-3deg);} 100% {transform: scale(1) rotate(0);}
        }
        @keyframes spin { /* Unchanged */
            0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); }
        }
        @keyframes pulseIcon { /* Unchanged */
            0%, 100% { transform: scale(1) rotate(0deg); opacity: 1; filter: drop-shadow(0 0 10px var(--accent-cyan-glow));}
            50% { transform: scale(1.15) rotate(5deg); opacity: 0.8; filter: drop-shadow(0 0 20px var(--accent-cyan-glow));}
        }


        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif;
            background: var(--primary-bg);
            color: var(--text-primary);
            overflow-x: hidden; position: relative;
            -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
            transition: background-color 0.5s ease, color 0.5s ease; /* Theme transition */
        }
        
        body::before { 
            content: ""; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            width: 100%; height: 100%;
            background: 
                radial-gradient(ellipse at 15% 25%, var(--aurora-1), transparent 35%),
                radial-gradient(ellipse at 85% 35%, var(--aurora-2), transparent 45%),
                radial-gradient(ellipse at 35% 75%, var(--aurora-3), transparent 40%),
                radial-gradient(ellipse at 65% 85%, var(--aurora-4), transparent 50%);
            background-size: 300% 300%; 
            animation: animatedAuroraBackground 60s ease-in-out infinite;
            opacity: var(--aurora-opacity); /* Controlled by theme */
            z-index: -1; pointer-events: none;
            transition: opacity 0.5s ease;
        }

        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--tertiary-bg); border-radius: 10px; transition: background-color 0.3s ease; }
        ::-webkit-scrollbar-thumb:hover { background: var(--accent-cyan); }

        #app-wrapper { display: flex; height: 100vh; overflow: hidden; }

        #sticky-sidebar-nav {
            width: 280px; flex-shrink: 0;
            background-color: color-mix(in srgb, var(--primary-bg) 80%, transparent);
            backdrop-filter: blur(25px) saturate(170%);
            -webkit-backdrop-filter: blur(25px) saturate(170%);
            border-right: 1px solid var(--border-color);
            padding: 1.5rem; /* Reduced top/bottom padding */
            overflow-y: auto; height: 100vh; position: fixed; top: 0; left: 0; z-index: 100;
            display: flex; flex-direction: column;
            transition: background-color 0.5s ease, border-color 0.5s ease;
        }
        #sidebar-header { padding: 0.5rem 0; } /* Added padding */
        #sidebar-header h1 {
            font-weight: 800; font-size: 1.5rem; letter-spacing: -0.03em;
            background: linear-gradient(90deg, var(--accent-cyan-hover), var(--accent-magenta));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            margin-bottom: 0.25rem; /* Reduced margin */
        }
        #sidebar-header p { font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 1.5rem; }
        
        #theme-toggle-button {
            background: var(--tertiary-bg);
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
            padding: 0.5rem; border-radius: 0.5rem;
            margin-bottom: 1.5rem;
            cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            width: 100%;
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }
        #theme-toggle-button:hover {
            background: var(--border-color);
            color: var(--text-primary);
        }
        #theme-toggle-button .lucide { width: 20px; height: 20px; }


        #module-navigation-list { flex-grow: 1; } /* Allow list to take available space */

        .sidebar-module-link {
            display: flex; align-items: center; padding: 0.8rem 1rem; border-radius: 0.6rem;
            color: var(--text-secondary); font-weight: 500; transition: all 0.25s ease;
            margin-bottom: 0.5rem; border: 1px solid transparent;
        }
        .sidebar-module-link .lucide { margin-right: 0.75rem; width: 20px; height: 20px; stroke-width: 2; transition: color 0.25s ease; }
        .sidebar-module-link:hover { background-color: var(--tertiary-bg); color: var(--text-primary); border-color: var(--border-color); }
        .sidebar-module-link.active {
            background: linear-gradient(90deg, var(--accent-cyan), var(--accent-magenta));
            color: white !important; font-weight: 600; box-shadow: 0 5px 15px var(--accent-cyan-glow);
        }
        .sidebar-module-link.active .lucide { color: white !important; }
        .sidebar-module-link .module-progress {
            margin-left: auto; font-size: 0.75rem; background-color: var(--tertiary-bg);
            padding: 0.1rem 0.4rem; border-radius: 0.25rem;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .sidebar-module-link.active .module-progress { background-color: rgba(255,255,255,0.2); color: white; }


        #scroll-container { flex-grow: 1; overflow-y: auto; height: 100vh; padding-left: 280px; }

        .section-padding { padding: 6rem 4rem; } 
        @media (max-width: 768px) {
            .section-padding { padding: 4rem 1.5rem; }
            #sticky-sidebar-nav { width: 100%; height: auto; position: relative; z-index: 101; /* Ensure it's above content when stacked */ border-right: none; border-bottom: 1px solid var(--border-color); }
            #scroll-container { padding-left: 0; }
            #app-wrapper { flex-direction: column; }
        }


        #hero-section {
            min-height: 90vh; display: flex; flex-direction: column;
            justify-content: center; align-items: center; text-align: center; position: relative;
        }
        #hero-section h2 {
            font-size: clamp(2.8rem, 9vw, 6rem); font-weight: 900; letter-spacing: -0.05em; line-height: 1.05;
            margin-bottom: 1.5rem;
            background: linear-gradient(120deg, var(--accent-cyan-hover) 15%, var(--accent-magenta-hover) 55%, #FFD700 90%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            animation: textShine 7s linear infinite, fadeInSlideUp 1s ease-out 0.2s backwards;
            background-size: 280% auto;
        }
        #hero-section .hero-subtitle {
            font-size: clamp(1.1rem, 3.5vw, 1.6rem); color: var(--text-secondary); max-width: 750px;
            margin-bottom: 3rem; line-height: 1.65;
            animation: fadeInSlideUp 1s ease-out 0.5s backwards;
        }
        #hero-section .scroll-down-indicator {
            position: absolute; bottom: 2.5rem;
            animation: subtleFloat 2.2s ease-in-out infinite, fadeInSlideUp 1s ease-out 0.8s backwards;
        }
        #hero-section .scroll-down-indicator .lucide { width: 32px; height: 32px; color: var(--accent-cyan); }

        .module-section {
            min-height: 100vh; border-bottom: 1px solid var(--border-color);
            display: flex; flex-direction: column; justify-content: center;
            transition: border-color 0.5s ease;
        }
        .module-section:last-of-type { border-bottom: none; }

        .module-header {
            text-align: center; margin-bottom: 5rem; /* More space */
            /* animation applied by JS observer */
        }
        .module-title-main-wrapper { /* Wrapper for text animation */
            overflow: hidden; /* Clip animation */
        }
        .module-title-main {
            font-size: clamp(2.2rem, 7vw, 4.5rem); font-weight: 800; letter-spacing: -0.035em;
            margin-bottom: 0.75rem; color: var(--text-primary);
            display: inline-block; /* For transform origin */
            transform: translateY(100%); opacity: 0;
            transition: color 0.5s ease;
        }
        .module-header.is-visible .module-title-main {
            animation: revealText 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
        }
        @keyframes revealText {
            to { transform: translateY(0); opacity: 1; }
        }

        .module-description {
            font-size: 1.15rem; color: var(--text-secondary); max-width: 650px;
            margin: 0 auto 1.5rem auto;
            transition: color 0.5s ease;
        }

        .lesson-block {
            background-color: color-mix(in srgb, var(--secondary-bg) 70%, transparent);
            border: 1px solid var(--border-color);
            border-radius: 1.25rem; /* More rounded */
            padding: 2.5rem 3rem; /* More padding */
            margin-bottom: 3.5rem; /* More spacing */
            box-shadow: 0 15px 40px var(--card-shadow);
            opacity: 0; transform: translateY(35px);
            transition: opacity 0.7s ease-out, transform 0.7s ease-out, background-color 0.5s ease, border-color 0.5s ease;
        }
        .lesson-block.is-visible { opacity: 1; transform: translateY(0); }

        /* Styling for elements inside .lesson-block, like #lesson-title, #lesson-instruction etc. */
        /* Will inherit themed variables. Adjust specifics if needed for light/dark contrast. */
        .lesson-block #lesson-title { 
            font-size: clamp(1.6rem, 4.5vw, 2.8rem); font-weight: 700;
            letter-spacing: -0.025em; color: var(--text-interactive);
            margin-bottom: 1.75rem;
            transition: color 0.5s ease;
        }
        .lesson-block #lesson-instruction { color: var(--text-secondary); line-height: 1.75; font-size: 1.05rem; transition: color 0.5s ease; }
        .lesson-block #lesson-instruction strong { color: var(--text-primary); font-weight: 600; transition: color 0.5s ease; }
        .lesson-block #lesson-instruction code {
            background-color: var(--tertiary-bg); color: var(--accent-cyan);
            padding: 0.25rem 0.5rem; border-radius: 0.4rem;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;
            border: 1px solid var(--border-color);
            transition: background-color 0.5s ease, color 0.5s ease, border-color 0.5s ease;
        }
        .lesson-block #lesson-instruction ul li::marker { color: var(--accent-cyan); transition: color 0.5s ease; }

        .lesson-block #lesson-example {
            background-color: color-mix(in srgb, var(--border-color) 30%, transparent);
            border: 1px solid var(--border-color);
            padding: 1.5rem; border-radius: 0.75rem; margin-top: 1.75rem;
            transition: background-color 0.5s ease, border-color 0.5s ease;
        }
        .lesson-block #lesson-example h4 { color: var(--text-primary); font-weight: 600; font-size: 1rem; transition: color 0.5s ease; }
        .lesson-block #lesson-example p { font-size: 0.9rem; color: var(--text-secondary); transition: color 0.5s ease; }

        .lesson-block #quiz-area { border-top: 1px solid var(--border-color); margin-top: 2.5rem; padding-top: 2.5rem; transition: border-color 0.5s ease;}
        .lesson-block #quiz-question-title { color: var(--text-primary); font-weight: 700; font-size: 1.25rem; transition: color 0.5s ease;}
        .lesson-block #quiz-question { color: var(--text-primary); font-size: 1.1rem; font-weight: 500; margin-bottom: 1.5rem; transition: color 0.5s ease;}
        
        .lesson-block .lesson-option {
            background-color: var(--tertiary-bg); border: 2px solid var(--border-color); color: var(--text-primary);
            transition: all 0.25s ease; border-radius: 0.75rem; padding: 1rem 1.25rem; font-weight: 500;
        }
        .lesson-block .lesson-option:hover:not(:disabled) {
            background-color: var(--border-color); border-color: var(--accent-cyan);
            transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        /* Correct and Incorrect styles using themed variables */
        .lesson-block .lesson-option.correct { 
            background: linear-gradient(135deg, var(--accent-green), var(--accent-green-hover)) !important;
            border-color: var(--accent-green-hover) !important; 
            color: var(--lm-primary-bg) !important; /* Ensure good contrast on green */
             font-weight: 600;
        }
        body.light-mode .lesson-block .lesson-option.correct {
             color: var(--lm-secondary-bg) !important; /* White text on green for light mode */
        }

        .lesson-block .lesson-option.incorrect { 
            background: linear-gradient(135deg, var(--accent-red), var(--accent-red-hover)) !important;
            border-color: var(--accent-red-hover) !important; 
            color: var(--lm-primary-bg) !important;  /* Ensure good contrast on red */
            font-weight: 600;
        }
         body.light-mode .lesson-block .lesson-option.incorrect {
             color: var(--lm-secondary-bg) !important; /* White text on red for light mode */
        }
        
        .lesson-block #feedback-area p { font-weight: 500; padding: 0.75rem 1rem; border-radius: 0.5rem; }
        .lesson-block #feedback-area .feedback-correct { background-color: color-mix(in srgb, var(--accent-green) 15%, transparent); color: var(--accent-green-hover); border: 1px solid var(--accent-green); }
        .lesson-block #feedback-area .feedback-incorrect { background-color: color-mix(in srgb, var(--accent-red) 15%, transparent); color: var(--accent-red-hover); border: 1px solid var(--accent-red); }

        /* Visual Aid Placeholder */
        .visual-aid-placeholder {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            min-height: 250px;
            background-color: color-mix(in srgb, var(--tertiary-bg) 50%, transparent);
            border: 2px dashed var(--border-color);
            border-radius: 0.75rem;
            padding: 2rem; text-align: center;
            transition: background-color 0.5s ease, border-color 0.5s ease;
        }
        .visual-aid-placeholder .lucide {
            width: 48px; height: 48px; color: var(--text-secondary); margin-bottom: 1rem;
            transition: color 0.5s ease;
        }
        .visual-aid-placeholder p { color: var(--text-secondary); font-style: italic; transition: color 0.5s ease;}

        /* General Buttons */
        #restart-course-button { /* For completion screen */
            background: linear-gradient(95deg, var(--accent-cyan), var(--accent-magenta));
            color: white; font-weight: 600; padding: 0.75rem 1.5rem; border-radius: 0.6rem;
            box-shadow: 0 4px 15px var(--accent-cyan-glow), 0 2px 8px var(--accent-magenta-glow);
            transition: all 0.25s ease; border: none;
        }
         #restart-course-button:hover {
            transform: translateY(-3px) scale(1.03);
            box-shadow: 0 7px 20px var(--accent-cyan-glow), 0 4px 12px var(--accent-magenta-glow);
        }


        #completion-section {
            min-height: 80vh; display: flex; flex-direction: column;
            justify-content: center; align-items: center; text-align: center;
        }
        #completion-section h2 { font-size: 3rem; font-weight: 800; color: var(--accent-green-hover); transition: color 0.5s ease; }
        #completion-section p { font-size: 1.25rem; color: var(--text-secondary); margin-top: 0.5rem; transition: color 0.5s ease; }
        #completion-section .lucide-party-popper { width: 80px; height: 80px; color: var(--accent-cyan); margin-bottom: 1rem; animation: pop 0.5s ease-out forwards, tada 1.5s 0.5s ease-in-out infinite; transition: color 0.5s ease;}

        .animate-on-scroll { opacity: 0; transition: opacity 0.8s ease-out, transform 0.8s ease-out; }
        .animate-on-scroll.slide-up { transform: translateY(50px); }
        .animate-on-scroll.is-visible { opacity: 1; transform: translateY(0) translateX(0); }

    </style>
</head>
<body>
    <div id="app-wrapper">
        <nav id="sticky-sidebar-nav">
            <div id="sidebar-header">
                <h1>Gemini Skills</h1>
                <p>Workspace Booster</p>
            </div>
            <button id="theme-toggle-button" aria-label="Toggle theme">
                <i data-lucide="sun" id="theme-icon-sun"></i>
                <i data-lucide="moon" id="theme-icon-moon" class="hidden"></i>
            </button>
            <ul id="module-navigation-list">
                <!-- Module links will be injected here by JS -->
            </ul>
        </nav>

        <main id="scroll-container">
            <section id="hero-section" class="section-padding">
                <h2>Unlock Your AI Potential<br/>with Gemini in Workspace.</h2>
                <p class="hero-subtitle">Master the tools that redefine productivity. Scroll to begin your journey into the future of work.</p>
                <div class="scroll-down-indicator">
                    <i data-lucide="arrow-down-circle"></i>
                </div>
            </section>

            <!-- Module and Lesson content will be injected here by JS -->

            <section id="completion-section" class="section-padding hidden">
                 <i data-lucide="party-popper"></i>
                <h2>Course Completed!</h2>
                <p>Congratulations! You've mastered the Gemini Workspace Skills Booster.</p>
                <button id="restart-course-button" class="mt-8 text-white font-semibold py-3 px-6 rounded-lg shadow-md transition duration-150 ease-in-out text-base">
                    Restart Course
                </button>
            </section>
        </main>
    </div>

<script>
// Ensure Lucide icons are replaced after DOM content is loaded
function replaceLucideIcons() {
    setTimeout(() => {
        if (typeof lucide !== 'undefined') {
            lucide.createIcons();
        } else {
            console.warn("Lucide library not loaded yet for icon replacement.");
            setTimeout(() => {
                if (typeof lucide !== 'undefined') { lucide.createIcons(); }
                 else { console.error("Lucide library failed to load for icon replacement."); }
            }, 600);
        }
    }, 100); 
}


document.addEventListener('DOMContentLoaded', () => {
    const courseData = [
        {
            moduleId: "gemini-fundamentals",
            moduleTitle: "Gemini: The Foundation", // Shorter title
            moduleDescription: "Grasp the core concepts of Gemini and its transformative power in your daily Google Workspace tasks.",
            moduleIcon: "atom", // Lucide icon name
            lessons: [
                {
                    lessonId: "fundamentals-1",
                    title: "Meet Gemini: Your AI Partner",
                    instruction: `<p>Gemini for Google Workspace isn't just a tool; it's your intelligent partner, seamlessly integrated into Gmail, Docs, Sheets, Slides, Meet, and Chat. Its mission is to amplify your productivity, spark creativity, and streamline complex enterprise workflows.</p><p><strong>Core Capabilities at a Glance:</strong></p><ul><li><strong>Intelligent Content Creation:</strong> Effortlessly draft professional emails, insightful documents, and compelling presentations.</li><li><strong>Insightful Summarization:</strong> Distill lengthy texts, cluttered email threads, or extensive meeting transcripts into concise, actionable summaries.</li><li><strong>Dynamic Brainstorming:</strong> Generate a wealth of ideas for innovative projects, impactful campaigns, or effective problem-solving strategies.</li><li><strong>Advanced Data Analysis (Sheets):</strong> Simplify complex data tasks by getting help with formulas, data interpretation, and table construction.</li><li><strong>Streamlined Workflows:</strong> Automate repetitive tasks and receive smart suggestions that anticipate your needs.</li></ul><p>Built on Google's robust AI Principles, Gemini prioritizes safety, fairness, and data privacy—paramount in any enterprise setting.</p>`,
                    example: `Imagine you're a marketing lead. Gemini can help draft a campaign launch announcement in Gmail, outline a strategy document in Docs, build a performance tracker in Sheets for key metrics, and generate initial slide content for a results presentation in Slides.`,
                    quiz: {
                        question: "Which of these best describes Gemini's role in Google Workspace according to the lesson?",
                        options: [
                            "A standalone AI application for specialized tasks.",
                            "An intelligent partner integrated across apps to boost productivity and creativity.",
                            "A tool primarily for automating calendar management.",
                            "A replacement for human collaboration in projects."
                        ],
                        correctAnswer: "An intelligent partner integrated across apps to boost productivity and creativity."
                    },
                    completed: false
                },
                {
                    lessonId: "fundamentals-2",
                    title: "Accessing Gemini: UI & Interactions",
                    instruction: `<p>Gemini's intelligence is woven into the fabric of each Workspace app, making its features intuitive to access. Familiarize yourself with these common interaction points:</p><ul><li>✨ **The Sparkle Icon:** This ubiquitous symbol is your primary cue for Gemini-powered features, often found on buttons or within toolbars, inviting you to leverage AI.</li><li><strong>Contextual Action Buttons:</strong> Look for explicit prompts like 'Help me write,' 'Help me organize,' or 'Help me visualize.' These buttons trigger specific Gemini capabilities tailored to your current task.</li><li><strong>Dedicated Side Panels/Panes:</strong> Certain applications may offer a persistent Gemini panel, providing ongoing assistance and a conversational interface.</li><li><strong>@-Mentions for Quick Actions:** In collaborative environments like Docs or Chat, typing <code>@gemini</code> followed by your request can often invoke direct AI actions.</li></ul><p>Note: The precise appearance and availability of Gemini features can be influenced by your enterprise administrator's settings and ongoing Google updates.</p>`,
                    example: `In Google Docs, clicking a ✨ button might offer to draft the next paragraph or summarize a section. In Gmail, a 'Summarize this thread' button with the sparkle icon could appear above lengthy conversations. Within Sheets, a dedicated Gemini side panel could help you generate complex formulas from natural language queries.`,
                    // No imagePrompt here, this lesson is more conceptual about UI patterns
                    quiz: {
                        question: "What is a primary visual indicator for Gemini-powered features within Google Workspace applications?",
                        options: [
                            "A magnifying glass icon for search.",
                            "The sparkle icon (✨) on buttons or in toolbars.",
                            "A settings gear icon for configuration.",
                            "A cloud upload icon for saving."
                        ],
                        correctAnswer: "The sparkle icon (✨) on buttons or in toolbars."
                    },
                    completed: false
                },
                 {
                    lessonId: "fundamentals-3",
                    title: "Responsible AI: Trust & Privacy",
                    instruction: `<p>Leveraging AI in an enterprise environment demands an unwavering commitment to responsibility, data security, and ethical use. Google has engineered Gemini for Workspace with these foundational principles:</p><ul><li><strong>Your Data Remains Yours:</strong> Crucially, your company's proprietary data (emails, documents, spreadsheets, etc.) is <strong>not</strong> used to train Google's general foundation models that serve other customers or the public. You maintain full ownership and control.</li><li><strong>You Are in Command:</strong> Gemini acts as an assistant, providing intelligent suggestions and drafts. However, <strong>you</strong> always retain ultimate control. Every piece of AI-generated content requires your review, critical editing, and explicit approval before use or distribution.</li><li><strong>The Imperative of Fact-Checking:</strong> Generative AI, while powerful, can occasionally produce inaccuracies or incomplete information (often termed 'hallucinations'). It is vital to critically evaluate all of Gemini's outputs, especially those involving factual claims or data-sensitive operations. Always cross-verify information with trusted, reliable sources.</li><li><strong>Cultivating Bias Awareness:</strong> AI models learn from vast datasets, which may inadvertently reflect existing societal biases. Be vigilant and mindful of potential biases in generated content. Strive for fairness, equity, and inclusivity in all your final work produced with AI assistance.</li></ul><p>Furthermore, ensure you are well-versed in your organization's specific policies and guidelines regarding the use of artificial intelligence tools.</p>`,
                    example: `If Gemini assists in drafting a market analysis report in Google Docs, your responsibility is to meticulously verify every statistic, claim, and projection against your company's internal data, validated industry reports, or other authoritative sources before presenting the report to stakeholders or making decisions based on it.`,
                    imagePrompt: "An abstract image representing data security and trust. Perhaps a stylized shield or a secure lock icon with digital circuit patterns, against a backdrop that conveys professionalism and safety. Colors should be reassuring, maybe blues and greens, with a modern tech feel.",
                    quiz: {
                        question: "What is Google's stance on using your enterprise data with Gemini in Workspace for training general AI models available to other customers?",
                        options: [
                            "All enterprise data is used to improve AI for everyone, after anonymization.",
                            "Your enterprise data is NOT used to train general models for other customers; you retain control.",
                            "Data is only used if an administrator explicitly opts-in the entire organization.",
                            "Only non-sensitive documents are used for general model training."
                        ],
                        correctAnswer: "Your enterprise data is NOT used to train general models for other customers; you retain control."
                    },
                    completed: false
                },
            ]
        },
        {
            moduleId: "gemini-gmail",
            moduleTitle: "Gmail: AI-Powered Email",
            moduleDescription: "Revolutionize your inbox. Learn to draft, summarize, and manage emails with unparalleled AI efficiency in Gmail.",
            moduleIcon: "mail-check", // More specific icon
            lessons: [
                {
                    lessonId: "gmail-1",
                    title: "Rapid Email Drafting: 'Help me write'",
                    instruction: `<p>The 'Help me write' feature in Gmail, supercharged by Gemini, dramatically accelerates email composition. Simply provide a prompt, and Gemini crafts a contextual draft, saving you valuable time.</p><p><strong>Leveraging 'Help me write':</strong></p><ol><li>Initiate a new email or reply. Locate and click the 'Help me write' button (often distinguished by a ✨ icon).</li><li>In the prompt field, articulate your email's objective, intended recipient, key information, and desired tone. Specificity yields better results.</li><li>Gemini generates a draft. You then have several refinement options:<ul><li><strong>Insert:</strong> Seamlessly integrate the draft into your email compose window.</li><li><strong>Recreate:</strong> Request a new draft, possibly after refining your initial prompt for better clarity or a different angle.</li><li><strong>Refine Options:</strong> Utilize built-in tools like 'Formalize,' 'Elaborate,' 'Shorten,' or 'Summarize' to fine-tune the draft. You can also provide custom textual instructions for more nuanced adjustments.</li></ul></li></ol><p>Ethical Reminder: Always meticulously review and edit any AI-generated draft for accuracy, appropriate tone, and completeness before sending any communication.</p>`,
                    example: `Your prompt for 'Help me write': 'Draft a professional email to the "Project Alpha Team", cc'ing "manager@example.com". Congratulate them on the successful launch of Project Alpha. Specifically mention their dedication and the positive client feedback received regarding the new UI. Politely request their preparation for a post-launch review meeting scheduled for next Tuesday at 10 AM.'`,
                    imagePrompt: "A clean mock-up of the Gmail compose window. The 'Help me write ✨' button is subtly highlighted. A conceptual text bubble shows a user typing a detailed prompt. The generated email draft appears below, looking professional. Focus on clarity and a modern, uncluttered interface.",
                    quiz: {
                        question: "When using Gemini's 'Help me write' in Gmail, which action is essential *before* sending the email?",
                        options: [
                            "Immediately clicking 'Send' to save time.",
                            "Asking Gemini to send it automatically.",
                            "Thoroughly reviewing and editing the draft for accuracy, tone, and completeness.",
                            "Shortening the draft, regardless of its initial quality."
                        ],
                        correctAnswer: "Thoroughly reviewing and editing the draft for accuracy, tone, and completeness."
                    },
                    completed: false
                },
                 {
                    lessonId: "gmail-2",
                    title: "Conquer Email Overload: Thread Summaries",
                    instruction: `<p>Effortlessly navigate long and complex email threads with Gemini's intelligent summarization feature in Gmail. This capability is invaluable for quickly grasping context, key decisions, and outstanding action items without needing to read every single message.</p><p><strong>How Thread Summarization Works:</strong></p><ul><li>For lengthy or eligible email threads, a 'Summarize' button (often accompanied by the ✨ icon) will typically appear at the top of the conversation.</li><li>Clicking this button prompts Gemini to analyze the thread and generate a concise summary of its most critical points.</li><li>The summary usually highlights the main topics discussed, significant decisions made, any unresolved questions, and assigned action items.</li></ul><p>This feature is particularly beneficial when: onboarding to an ongoing project, catching up after a period of absence, or needing a rapid understanding of a thread's essentials before a meeting or making a decision.</p>`,
                    example: `You've just been added to an email chain with over 50 replies debating crucial Q4 budget allocations. Instead of dedicating an hour to manual reading, you click 'Summarize.' Gemini swiftly provides a 4-bullet point overview: 1. Initial proposal: 20% budget cut across all departments. 2. Marketing & R&D raised concerns about impact on innovation and Q1 campaigns. 3. Finance proposed tiered cuts: 10% for core operations, 15% for discretionary, 5% for strategic growth areas. 4. Consensus pending on final percentages for strategic growth.`,
                    imagePrompt: "An abstract visual representation of a tangled, complex line (representing an email thread) being neatly unraveled and transformed into a series of clear, concise bullet points. A subtle Gemini sparkle icon should be part of the transformation effect. Use a dark, tech-inspired background with cyan and magenta highlights.",
                    quiz: {
                        question: "What is the primary advantage of using Gemini to summarize email threads in Gmail?",
                        options: [
                            "It automatically replies to all unread emails in the thread.",
                            "It allows you to quickly understand the core information and key takeaways from long conversations without reading every email.",
                            "It translates the entire email thread into multiple languages simultaneously.",
                            "It permanently archives the original emails after creating a summary."
                        ],
                        correctAnswer: "It allows you to quickly understand the core information and key takeaways from long conversations without reading every email."
                    },
                    completed: false
                }
            ]
        },
        {
            moduleId: "gemini-slides",
            moduleTitle: "Slides: AI-Enhanced Presentations",
            moduleDescription: "Design compelling presentations with AI assistance for outlines, content, and unique visuals in Google Slides.",
            moduleIcon: "presentation", // Lucide icon name
            lessons: [
                {
                    lessonId: "slides-1",
                    title: "Kickstart Your Story: Outline & Content Generation",
                    instruction: `<p>Overcome the blank-slide challenge with Gemini in Google Slides. It can be your creative partner, generating structured outlines and drafting initial content to get your presentation off to a flying start.</p><p><strong>How Gemini Ignites Your Presentation:</strong></p><ol><li>Begin a new presentation or open an existing one.</li><li>Access Gemini, typically through a 'Help me create' button or the ✨ icon.</li><li>Provide a clear prompt detailing your presentation's topic, target audience, desired length (e.g., number of slides), and key sections or messages you want to include. Examples:<ul><li>'Generate a 7-slide presentation outline for a workshop on "Effective Time Management for Remote Teams".'</li><li>'Draft compelling content for an introductory slide about our company's new sustainability initiative, targeting potential investors.'</li><li>'Suggest three key talking points and a powerful call to action for a presentation on the benefits of our new SaaS product.'</li></ul></li><li>Gemini will propose an outline or draft content. You can then insert this into your slides and begin the process of refining, adding your unique insights, customizing visuals, and ensuring brand alignment.</li></ol><p>This AI-assisted approach provides a robust foundation, saving you time and sparking further ideas for a polished and impactful presentation.</p>`,
                    example: `Your prompt: 'Create a comprehensive outline for a 20-minute internal presentation to new software engineers about our company's coding standards and development lifecycle. Key sections should include: Introduction to our philosophy, Version Control (Git), Code Review Process, Testing Pyramid, Deployment Pipeline, and Q&A.' Gemini will then generate a detailed slide-by-slide structural outline.`,
                    imagePrompt: "A visual metaphor of an AI (represented by a subtle, glowing circuit pattern or a sparkle icon) constructing a presentation slide by slide. Show an empty slide transforming into a structured one with title, bullet points, and a placeholder for an image. Use a dynamic, slightly isometric perspective. Dark background with cyan and magenta accents.",
                    quiz: {
                        question: "How does Gemini primarily assist in the initial creation phase of a Google Slides presentation?",
                        options: [
                            "By automatically selecting the final color theme and font pairings.",
                            "By delivering the presentation to a pre-defined audience list.",
                            "By generating structured presentation outlines and drafting initial content for slides based on user prompts.",
                            "By exclusively inserting images from a restricted internal company library."
                        ],
                        correctAnswer: "By generating structured presentation outlines and drafting initial content for slides based on user prompts."
                    },
                    completed: false
                },
                // Add more slides lessons here
            ]
        }
        // ... Add ALL other modules and their lessons here, ensuring each module has:
        // moduleId, moduleTitle, moduleDescription, moduleIcon, and an array of lessons.
        // Each lesson needs: lessonId, title, instruction, example, quiz (with question, options, correctAnswer), completed status.
        // Add 'imagePrompt' to lessons where a visual placeholder is desired.
    ];

    const scrollContainer = document.getElementById('scroll-container');
    const moduleNavList = document.getElementById('module-navigation-list');
    const completionSection = document.getElementById('completion-section');
    const restartCourseButton = document.getElementById('restart-course-button');
    const themeToggleButton = document.getElementById('theme-toggle-button');
    const themeIconSun = document.getElementById('theme-icon-sun');
    const themeIconMoon = document.getElementById('theme-icon-moon');


    // --- Theme Toggle ---
    function setTheme(theme) {
        if (theme === 'light') {
            document.body.classList.add('light-mode');
            if(themeIconSun) themeIconSun.classList.add('hidden');
            if(themeIconMoon) themeIconMoon.classList.remove('hidden');
        } else {
            document.body.classList.remove('light-mode');
            if(themeIconSun) themeIconSun.classList.remove('hidden');
            if(themeIconMoon) themeIconMoon.classList.add('hidden');
        }
        // Store preference
        try {
            localStorage.setItem('geminiSkillsTheme', theme);
        } catch (e) {
            console.warn("Could not save theme preference to localStorage.");
        }
        replaceLucideIcons(); 
    }

    if (themeToggleButton) {
        themeToggleButton.addEventListener('click', () => {
            if (document.body.classList.contains('light-mode')) {
                setTheme('dark');
            } else {
                setTheme('light');
            }
        });
    }
    
    function loadSavedTheme() {
        try {
            const savedTheme = localStorage.getItem('geminiSkillsTheme');
            if (savedTheme) {
                setTheme(savedTheme);
            } else {
                setTheme('dark'); // Default to dark if no preference saved
            }
        } catch (e) {
            console.warn("Could not load theme preference from localStorage, defaulting to dark.");
            setTheme('dark');
        }
    }


    // --- Animation Observer ---
    const animationObserver = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('is-visible');
            } else {
                // Optional: remove 'is-visible' to re-trigger animation on scroll back
                // entry.target.classList.remove('is-visible');
            }
        });
    }, { threshold: 0.15 }); 

    function observeElements(selector) {
        document.querySelectorAll(selector).forEach(el => {
            animationObserver.observe(el);
        });
    }
    
    // --- UI RENDERING ---
    function renderCourse() {
        moduleNavList.innerHTML = '';
        Array.from(scrollContainer.querySelectorAll('.module-section')).forEach(el => el.remove());

        courseData.forEach((module, moduleIdx) => {
            const li = document.createElement('li');
            const link = document.createElement('a');
            link.href = `#module-${module.moduleId}`;
            link.className = 'sidebar-module-link';
            link.innerHTML = `
                <i data-lucide="${module.moduleIcon || 'book-open'}"></i>
                <span>${module.moduleTitle}</span>
                <span class="module-progress" id="progress-${module.moduleId}">0%</span>
            `;
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const targetSection = document.querySelector(link.getAttribute('href'));
                if (targetSection) {
                    targetSection.scrollIntoView({ behavior: 'smooth' });
                }
                updateActiveModuleNav(module.moduleId);
            });
            li.appendChild(link);
            moduleNavList.appendChild(li);

            const moduleSection = document.createElement('section');
            moduleSection.id = `module-${module.moduleId}`;
            moduleSection.className = 'module-section section-padding'; 
            
            let moduleHTML = `
                <div class="module-header animate-on-scroll slide-up">
                    <div class="module-title-main-wrapper">
                        <h3 class="module-title-main">${module.moduleTitle}</h3>
                    </div>
                    <p class="module-description">${module.moduleDescription || ''}</p>
                </div>
            `;

            module.lessons.forEach((lesson, lessonIdx) => {
                // Determine if the lesson is the last in its module AND the last module overall
                const isLastLessonOverall = (moduleIdx === courseData.length - 1) && (lessonIdx === module.lessons.length - 1);

                moduleHTML += `
                    <div class="lesson-block" data-module-index="${moduleIdx}" data-lesson-index="${lessonIdx}">
                        <h4 id="lesson-title">${lesson.title}</h4>
                        
                        ${lesson.imagePrompt ? `
                        <div id="visual-aid-section" class="mb-6">
                            <div class="visual-aid-container-lesson visual-aid-placeholder my-4">
                                <i data-lucide="image"></i>
                                <p>Engaging visual content placeholder.</p>
                            </div>
                        </div>` : ''}

                        <div id="lesson-instruction" class="max-w-none mb-6">${lesson.instruction}</div>
                        ${lesson.example ? `
                        <div id="lesson-example" class="p-4 rounded-lg mb-6">
                            <h5 class="font-semibold text-sm mb-2 flex items-center"><i data-lucide="lightbulb" class="mr-2 h-4 w-4 text-yellow-400"></i>Example:</h5>
                            <p class="text-xs">${lesson.example}</p>
                        </div>` : ''}
                        ${lesson.quiz ? `
                        <div id="quiz-area" class="mt-6 pt-4 border-t border-[var(--border-color)]">
                            <h5 id="quiz-question-title" class="text-md font-semibold mb-3 flex items-center"><i data-lucide="help-circle" class="mr-2 h-5 w-5 text-[var(--accent-cyan)]"></i>Test Your Knowledge:</h5>
                            <p id="quiz-question" class="mb-4">${lesson.quiz.question}</p>
                            <div class="quiz-options-lesson grid grid-cols-1 sm:grid-cols-2 gap-3">
                                ${lesson.quiz.options.map(opt => `<button class="lesson-option">${opt}</button>`).join('')}
                            </div>
                            <div class="feedback-area-lesson mt-4">
                                <p class="feedback-message-lesson text-xs p-2 rounded-md"></p>
                            </div>
                        </div>` : `<div class="my-4 p-3 bg-[var(--tertiary-bg)] rounded-md text-sm text-[var(--text-secondary)] transition-colors duration-500"><i data-lucide="info" class="inline w-4 h-4 mr-2"></i>This lesson is informational. No quiz.</div>`}
                        <div class="next-lesson-button-container mt-6 text-right" data-is-last-overall="${isLastLessonOverall}"></div>
                    </div>
                `;
            });
            moduleSection.innerHTML = moduleHTML;
            scrollContainer.insertBefore(moduleSection, completionSection);
        });

        addEventListenersToLessons();
        updateAllModuleProgressDisplays();
        replaceLucideIcons();
        observeElements('.animate-on-scroll, .lesson-block, .module-header');
    }
    
    function updateActiveModuleNav(visibleModuleId) {
        document.querySelectorAll('.sidebar-module-link').forEach(link => {
            if (link.getAttribute('href') === `#${visibleModuleId}`) {
                link.classList.add('active');
            } else {
                link.classList.remove('active');
            }
        });
    }

    const moduleObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                updateActiveModuleNav(entry.target.id);
            }
        });
    }, { root: scrollContainer, threshold: 0.4, rootMargin: "-40% 0px -40% 0px" }); 

    function observeModuleSections() {
        document.querySelectorAll('.module-section').forEach(section => {
            moduleObserver.observe(section);
        });
    }

    function addEventListenersToLessons() {
        document.querySelectorAll('.lesson-block').forEach(lessonBlock => {
            const moduleIndex = parseInt(lessonBlock.dataset.moduleIndex);
            const lessonIndex = parseInt(lessonBlock.dataset.lessonIndex);
            const lesson = courseData[moduleIndex].lessons[lessonIndex];

            // Quiz Options (only if quiz exists)
            if (lesson.quiz) {
                const quizOptionsContainer = lessonBlock.querySelector('.quiz-options-lesson');
                const optionButtons = quizOptionsContainer.querySelectorAll('.lesson-option');
                const feedbackMessageEl = lessonBlock.querySelector('.feedback-message-lesson');
                const nextButtonContainer = lessonBlock.querySelector('.next-lesson-button-container'); 

                optionButtons.forEach(button => {
                    button.onclick = () => {
                        handleQuizOptionSelect(button, button.textContent, lesson, optionButtons, feedbackMessageEl, nextButtonContainer, moduleIndex, lessonIndex);
                    };
                });
                if(lesson.completed){ // If re-rendering and lesson was already complete
                    feedbackMessageEl.innerHTML = '<strong>Lesson Completed!</strong> You can review or scroll on.';
                    feedbackMessageEl.className = 'feedback-message-lesson text-xs p-2 rounded-md feedback-correct';
                    optionButtons.forEach(btn => {
                         btn.disabled = true;
                         if (btn.textContent === lesson.quiz.correctAnswer) btn.classList.add('correct');
                    });
                    showNextOrComplete(nextButtonContainer, moduleIndex, lessonIndex, true);
                }
            } else {
                const nextButtonContainer = lessonBlock.querySelector('.next-lesson-button-container');
                showNextOrComplete(nextButtonContainer, moduleIndex, lessonIndex, true); // Treat as "completed" for flow if no quiz
            }
        });
    }

    function handleQuizOptionSelect(selectedButtonEl, selectedAnswer, lesson, allOptionButtons, feedbackEl, nextBtnContainer, moduleIdx, lessonIdx) {
        allOptionButtons.forEach(btn => btn.disabled = true);

        if (selectedAnswer === lesson.quiz.correctAnswer) {
            feedbackEl.innerHTML = '<strong>Correct!</strong> Splendid work.';
            feedbackEl.className = 'feedback-message-lesson text-xs p-2 rounded-md feedback-correct';
            selectedButtonEl.classList.add('correct');
            lesson.completed = true;
        } else {
            feedbackEl.innerHTML = `<strong>Not quite.</strong> The correct answer: "<em>${lesson.quiz.correctAnswer}</em>". Keep learning!`;
            feedbackEl.className = 'feedback-message-lesson text-xs p-2 rounded-md feedback-incorrect';
            selectedButtonEl.classList.add('incorrect');
            allOptionButtons.forEach(btn => {
                if (btn.textContent === lesson.quiz.correctAnswer) {
                    btn.classList.add('correct');
                }
            });
        }
        showNextOrComplete(nextBtnContainer, moduleIdx, lessonIdx, lesson.completed);
        updateModuleProgressDisplay(courseData[moduleIdx].moduleId);
        if(lesson.completed) checkOverallCompletion(); // Check if this completion finishes the course
    }
    
    function showNextOrComplete(container, currentModuleIdx, currentLessonIdx, isCompleted) {
        if (!container) return;
        container.innerHTML = ''; 
        const isLastLessonInModule = currentLessonIdx === courseData[currentModuleIdx].lessons.length - 1;
        const isLastOverall = container.dataset.isLastOverall === "true";


        const p = document.createElement('p');
        p.className = 'font-semibold mt-4 text-sm';

        if (isCompleted) {
            p.classList.add('text-[var(--accent-green-hover)]'); // Use themed color
            p.innerHTML = 'Lesson Complete! <i data-lucide="check-circle" class="inline w-4 h-4"></i> ';
            
            if (isLastOverall) {
                 p.innerHTML += ' This is the final lesson!';
                 // The checkOverallCompletion will handle showing the main completion section
            } else if (isLastLessonInModule) {
                p.innerHTML += 'Module Finished! Scroll to the next one.';
            } else {
                 p.innerHTML += 'Scroll down for the next lesson.';
            }
        } else {
            // If quiz failed, no specific "next" message here, feedbackEl handles it.
            // If it's an informational lesson initially, this part won't be hit with isCompleted=false
        }
        
        if (p.innerHTML.trim() !== '') { // Only append if there's content
             container.appendChild(p);
             replaceLucideIcons();
        }
    }

    function updateModuleProgressDisplay(moduleId) {
        const moduleData = courseData.find(m => m.moduleId === moduleId);
        if (!moduleData) return;

        // A lesson is considered "done" for progress if it's marked completed OR if it has no quiz.
        const doneLessons = moduleData.lessons.filter(l => l.completed || !l.quiz).length;
        const totalLessons = moduleData.lessons.length;
        const progress = totalLessons > 0 ? Math.round((doneLessons / totalLessons) * 100) : 0;
        
        const progressEl = document.getElementById(`progress-${moduleId}`);
        if (progressEl) {
            progressEl.textContent = `${progress}%`;
            const linkEl = progressEl.closest('.sidebar-module-link');
            if (progress === 100) {
                linkEl?.classList.add('module-complete-visual'); 
            } else {
                 linkEl?.classList.remove('module-complete-visual');
            }
        }
    }

    function updateAllModuleProgressDisplays() {
        courseData.forEach(module => updateModuleProgressDisplay(module.moduleId));
    }

    function checkOverallCompletion() {
        const allDone = courseData.every(module => 
            module.lessons.every(lesson => lesson.completed || !lesson.quiz) // Non-quiz lessons count as complete
        );
        if (allDone) {
            completionSection.classList.remove('hidden');
            completionSection.scrollIntoView({ behavior: 'smooth' });
            // Animate completion section elements
            completionSection.querySelectorAll('.lucide-party-popper, h2, p, button').forEach(el => {
                el.classList.add('animate-on-scroll', 'slide-up', 'is-visible'); // Force visible
            });

        }
    }

    function initializeApp() {
        loadSavedTheme(); // Load theme preference first

        renderCourse();
        observeModuleSections(); 
        replaceLucideIcons(); 
        
        // Hero section animations
        setTimeout(() => {
            const heroH2 = document.querySelector('#hero-section h2');
            const heroSubtitle = document.querySelector('#hero-section .hero-subtitle');
            const scrollIndicator = document.querySelector('#hero-section .scroll-down-indicator');

            if(heroH2) heroH2.classList.add('is-visible');
            if(heroSubtitle) heroSubtitle.classList.add('is-visible');
            if(scrollIndicator) scrollIndicator.classList.add('is-visible');
        }, 100); // Short delay for effect

        if (restartCourseButton) {
            restartCourseButton.onclick = () => {
                courseData.forEach(m => m.lessons.forEach(l => l.completed = false));
                completionSection.classList.add('hidden');
                if(scrollContainer) scrollContainer.scrollTop = 0; 
                renderCourse(); 
                observeModuleSections();
                updateActiveModuleNav(courseData.length > 0 ? `module-${courseData[0].moduleId}` : ''); 
                loadSavedTheme(); // Re-apply theme after re-render, which might reset body class
                // Re-trigger hero animation for restart
                 setTimeout(() => {
                    document.querySelector('#hero-section h2')?.classList.add('is-visible');
                    document.querySelector('#hero-section .hero-subtitle')?.classList.add('is-visible');
                    document.querySelector('#hero-section .scroll-down-indicator')?.classList.add('is-visible');
                }, 100);
            };
        }
    }
    
    initializeApp();
});
</script>
</body>
</html>
