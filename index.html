<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini Skills Booster - Hyper-Interactive UI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/lucide-static@latest/dist/lucide.min.js"></script>

    <style>
        :root {
            /* --- Zenith Calm Theme (Defaults to Dark Zenith) --- */
            /* Dark Zenith */
            --dz-primary-bg: #0D111C;
            --dz-secondary-bg: #161D2F;
            --dz-tertiary-bg: #212A40;
            --dz-accent-primary: #4FD1C5; /* Teal */
            --dz-accent-primary-hover: #6BEBD8;
            --dz-accent-primary-glow: rgba(79, 209, 197, 0.25); /* Slightly increased glow */
            --dz-accent-secondary: #F6E05E; /* Muted Gold */
            --dz-accent-secondary-hover: #F9F07A;
            --dz-accent-secondary-glow: rgba(246, 224, 94, 0.2); /* Slightly increased glow */
            --dz-accent-green: #68D391;
            --dz-accent-green-hover: #81E6D9;
            --dz-accent-red: #FC8181;
            --dz-accent-red-hover: #FEB2B2;
            --dz-text-primary: #E2E8F0;
            --dz-text-secondary: #A0AEC0;
            --dz-border-color: #2D3748;
            --dz-aurora-opacity: 0.06; /* Slightly toned down for subtlety */
            --dz-card-shadow: 0 12px 30px rgba(0,0,0,0.25); /* Enhanced shadow */


            /* Light Zenith */
            --lz-primary-bg: #F7FAFC;
            --lz-secondary-bg: #FFFFFF;
            --lz-tertiary-bg: #EDF2F7;
            --lz-accent-primary: #3182CE; /* Professional Blue */
            --lz-accent-primary-hover: #2B6CB0;
            --lz-accent-primary-glow: rgba(49, 130, 206, 0.2); /* Slightly increased glow */
            --lz-accent-secondary: #A0AEC0; /* Silver/Gray */
            --lz-accent-secondary-hover: #718096;
            --lz-accent-secondary-glow: rgba(160, 174, 192, 0.15); /* Slightly increased glow */
            --lz-accent-green: #38A169;
            --lz-accent-green-hover: #2F855A;
            --lz-accent-red: #E53E3E;
            --lz-accent-red-hover: #C53030;
            --lz-text-primary: #1A202C;
            --lz-text-secondary: #4A5568;
            --lz-border-color: #CBD5E0;
            --lz-aurora-opacity: 0.03; /* Slightly toned down */
            --lz-card-shadow: 0 12px 30px rgba(0,0,0,0.1); /* Enhanced shadow */


            /* Applied Variables (Initially Dark Zenith) */
            --primary-bg: var(--dz-primary-bg);
            --secondary-bg: var(--dz-secondary-bg);
            --tertiary-bg: var(--dz-tertiary-bg);
            --accent-primary: var(--dz-accent-primary);
            --accent-primary-hover: var(--dz-accent-primary-hover);
            --accent-primary-glow: var(--dz-accent-primary-glow);
            --accent-secondary: var(--dz-accent-secondary);
            --accent-secondary-hover: var(--dz-accent-secondary-hover);
            --accent-secondary-glow: var(--dz-accent-secondary-glow);
            --accent-green: var(--dz-accent-green);
            --accent-green-hover: var(--dz-accent-green-hover);
            --accent-red: var(--dz-accent-red);
            --accent-red-hover: var(--dz-accent-red-hover);
            --text-primary: var(--dz-text-primary);
            --text-secondary: var(--dz-text-secondary);
            --text-interactive: var(--dz-accent-primary-hover); /* More specific name */
            --border-color: var(--dz-border-color);
            --card-shadow: var(--dz-card-shadow);
            --aurora-opacity: var(--dz-aurora-opacity);
            --aurora-1: #4FD1C5;
            --aurora-2: #F6E05E;
            --aurora-3: #68D391;
            --aurora-4: #FC8181;

            /* Easing functions */
            --ease-out-quad: cubic-bezier(0.25, 0.46, 0.45, 0.94);
            --ease-out-cubic: cubic-bezier(0.215, 0.610, 0.355, 1.000);
            --ease-in-out-cubic: cubic-bezier(0.645, 0.045, 0.355, 1.000);
            --ease-out-quart: cubic-bezier(0.165, 0.84, 0.44, 1); /* Common choice for smooth reveals */
        }

        body.theme-dark-zenith { /* Already default, but explicit for clarity */
            --primary-bg: var(--dz-primary-bg); --secondary-bg: var(--dz-secondary-bg); --tertiary-bg: var(--dz-tertiary-bg);
            --accent-primary: var(--dz-accent-primary); --accent-primary-hover: var(--dz-accent-primary-hover); --accent-primary-glow: var(--dz-accent-primary-glow);
            --accent-secondary: var(--dz-accent-secondary); --accent-secondary-hover: var(--dz-accent-secondary-hover); --accent-secondary-glow: var(--dz-accent-secondary-glow);
            --accent-green: var(--dz-accent-green); --accent-green-hover: var(--dz-accent-green-hover);
            --accent-red: var(--dz-accent-red); --accent-red-hover: var(--dz-accent-red-hover);
            --text-primary: var(--dz-text-primary); --text-secondary: var(--dz-text-secondary); --text-interactive: var(--dz-accent-primary-hover);
            --border-color: var(--dz-border-color); --card-shadow: var(--dz-card-shadow); --aurora-opacity: var(--dz-aurora-opacity);
            --aurora-1: #4FD1C5; --aurora-2: #F6E05E; --aurora-3: #68D391; --aurora-4: #FC8181;
        }
        body.theme-light-zenith {
            --primary-bg: var(--lz-primary-bg); --secondary-bg: var(--lz-secondary-bg); --tertiary-bg: var(--lz-tertiary-bg);
            --accent-primary: var(--lz-accent-primary); --accent-primary-hover: var(--lz-accent-primary-hover); --accent-primary-glow: var(--lz-accent-primary-glow);
            --accent-secondary: var(--lz-accent-secondary); --accent-secondary-hover: var(--lz-accent-secondary-hover); --accent-secondary-glow: var(--lz-accent-secondary-glow);
            --accent-green: var(--lz-accent-green); --accent-green-hover: var(--lz-accent-green-hover);
            --accent-red: var(--lz-accent-red); --accent-red-hover: var(--lz-accent-red-hover);
            --text-primary: var(--lz-text-primary); --text-secondary: var(--lz-text-secondary); --text-interactive: var(--lz-accent-primary);
            --border-color: var(--lz-border-color); --card-shadow: var(--lz-card-shadow); --aurora-opacity: var(--lz-aurora-opacity);
            --aurora-1: var(--lz-accent-primary); --aurora-2: var(--lz-accent-secondary); --aurora-3: #38A169; --aurora-4: #E53E3E;
        }

        /* Global Animations & Transitions */
        @keyframes animatedAuroraBackground {
            0% { background-position: 0% 0%; transform: scale(1.02) rotate(0deg); }
            25% { background-position: 100% 0%; transform: scale(1.07) rotate(0.5deg); }
            50% { background-position: 100% 100%; transform: scale(1.02) rotate(0deg); }
            75% { background-position: 0% 100%; transform: scale(1.07) rotate(-0.5deg); }
            100% { background-position: 0% 0%; transform: scale(1.02) rotate(0deg); }
        }
        @keyframes textShine {
            0% { background-position: -250% center; } 100% { background-position: 250% center; }
        }
        @keyframes heroScrollIndicatorFloat { /* Renamed and refined for scroll indicator */
            0%, 100% { transform: translateY(0); opacity: 0.6; }
            50% { transform: translateY(-12px); opacity: 1; }
        }
        @keyframes fadeInSlideUpInitial { /* For initial page load elements */
            from { opacity: 0; transform: translateY(40px) scale(0.98); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        @keyframes pop {
            0% { transform: scale(0.3) rotate(-15deg); opacity: 0; }
            60% { transform: scale(1.25) rotate(8deg); opacity: 1; }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }
        @keyframes tadaEnhanced {
            0% {transform: scale(1) rotate(0deg);}
            10%, 20% {transform: scale(0.9) rotate(-7deg) translateY(-2px);}
            30%, 50%, 70%, 90% {transform: scale(1.2) rotate(7deg) translateY(2px);}
            40%, 60%, 80% {transform: scale(1.2) rotate(-7deg) translateY(-2px);}
            100% {transform: scale(1) rotate(0deg);}
        }
        @keyframes pulseIcon {
            0%, 100% { transform: scale(1) rotate(0deg); filter: drop-shadow(0 0 8px var(--accent-primary-glow));} /* Reduced glow size */
            50% { transform: scale(1.15) rotate(5deg); filter: drop-shadow(0 0 18px var(--accent-primary-glow));} /* Adjusted pulse */
        }
        @keyframes feedbackCelebration {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            25% { transform: translateY(-5px) scale(1.05); color: var(--accent-green-hover); }
            50% { transform: translateY(0) scale(1); opacity: 1; }
            75% { transform: translateY(-3px) scale(1.03); }
            100% { transform: translateY(0) scale(1); opacity: 1; }
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-6px); }
            20%, 40%, 60%, 80% { transform: translateX(6px); }
        }
        @keyframes iconDrawIn {
            from { stroke-dashoffset: 24; } to { stroke-dashoffset: 0; }
        }
        .animate-check {
            stroke-dasharray: 24;
            stroke-dashoffset: 24;
            animation: iconDrawIn 0.5s var(--ease-out-cubic) forwards 0.2s;
        }

        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif;
            background: var(--primary-bg); color: var(--text-primary);
            overflow-x: hidden; position: relative;
            -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
            transition: background-color 0.4s var(--ease-in-out-cubic), color 0.4s var(--ease-in-out-cubic); /* Smoother transition */
        }

        body::before {
            content: ""; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            width: 100%; height: 100%;
            background:
                radial-gradient(ellipse at 10% 20%, var(--aurora-1), transparent 45%), /* Adjusted spread */
                radial-gradient(ellipse at 90% 30%, var(--aurora-2), transparent 55%), /* Adjusted spread */
                radial-gradient(ellipse at 30% 80%, var(--aurora-3), transparent 50%), /* Adjusted spread */
                radial-gradient(ellipse at 70% 70%, var(--aurora-4), transparent 60%); /* Adjusted spread */
            background-size: 280% 280%;
            animation: animatedAuroraBackground 60s var(--ease-in-out-cubic) infinite; /* Slower, smoother aurora */
            opacity: var(--aurora-opacity);
            z-index: -1; pointer-events: none;
            transition: opacity 0.5s var(--ease-in-out-cubic);
        }

        ::-webkit-scrollbar { width: 8px; height: 8px; } /* Slightly thicker */
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: color-mix(in srgb, var(--border-color) 50%, transparent); border-radius: 10px; transition: background-color 0.3s var(--ease-out-cubic); }
        ::-webkit-scrollbar-thumb:hover { background: var(--accent-primary); }

        #app-wrapper { display: flex; height: 100vh; overflow: hidden; }

        #sticky-sidebar-nav {
            width: 290px; flex-shrink: 0;
            background-color: color-mix(in srgb, var(--primary-bg) 70%, transparent); /* More transparency */
            backdrop-filter: blur(30px) saturate(150%); /* Enhanced blur */
            -webkit-backdrop-filter: blur(30px) saturate(150%);
            border-right: 1px solid var(--border-color);
            padding: 1.75rem 1.25rem;
            overflow-y: auto; height: 100vh; position: fixed; top: 0; left: 0; z-index: 100;
            display: flex; flex-direction: column;
            transition: background-color 0.4s var(--ease-in-out-cubic), border-color 0.4s var(--ease-in-out-cubic), transform 0.3s var(--ease-out-cubic);
        }
        #sidebar-header { padding: 0.5rem 0.25rem; }
        #sidebar-header h1 {
            font-weight: 800; font-size: 1.6rem; letter-spacing: -0.035em;
            background: linear-gradient(90deg, var(--accent-primary-hover), var(--accent-secondary));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            margin-bottom: 0.25rem;
        }
        #sidebar-header p { font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 1.75rem; transition: color 0.4s var(--ease-in-out-cubic);}

        /* Theme Toggle Button */
        #theme-cycler-container { margin-bottom: 1.75rem; padding: 0 0.25rem; }
        #theme-cycle-button {
            width: 100%; display: flex; align-items: center; justify-content: center;
            padding: 0.8rem 1rem; /* Adjusted padding */
            border-radius: 0.65rem; /* Slightly different radius */
            font-size: 0.875rem; font-weight: 500;
            transition: all 0.25s var(--ease-out-cubic); /* Consistent easing */
            cursor: pointer; border: 1px solid var(--border-color);
            background-color: var(--tertiary-bg); color: var(--text-primary);
        }
        #theme-cycle-button:hover {
            border-color: var(--accent-primary);
            background-color: color-mix(in srgb, var(--tertiary-bg) 75%, var(--accent-primary) 25%);
            color: var(--accent-primary-hover);
            transform: translateY(-2px) scale(1.02); /* Subtle lift */
            box-shadow: 0 5px 15px var(--accent-primary-glow);
        }
        #theme-cycle-button:active {
            transform: translateY(0px) scale(0.98); /* Press effect */
            box-shadow: 0 2px 8px color-mix(in srgb, var(--accent-primary-glow) 70%, transparent);
        }
        #theme-cycle-button:focus-visible {
            outline: 2px solid var(--accent-primary-hover);
            outline-offset: 2px;
            box-shadow: 0 0 0 3px color-mix(in srgb, var(--accent-primary) 30%, transparent), 0 5px 15px var(--accent-primary-glow);
        }
        #theme-cycle-button .lucide {
            margin-right: 0.6rem; width: 17px; height: 17px; /* Slightly smaller icon */
            stroke-width: 2.5; color: var(--text-interactive);
            transition: color 0.25s var(--ease-out-cubic);
        }
        #theme-cycle-button:hover .lucide { color: var(--accent-primary-hover); }

        #module-navigation-list { flex-grow: 1; display: flex; flex-direction: column; }

        .sidebar-module-link {
            display: flex; align-items: center; padding: 0.8rem 1rem; /* Adjusted padding */
            border-radius: 0.65rem; color: var(--text-secondary); font-weight: 500;
            transition: all 0.25s var(--ease-out-cubic);
            margin-bottom: 0.5rem; border: 1px solid transparent; position: relative;
            flex-shrink: 0;
        }
        .sidebar-module-link .lucide { margin-right: 0.75rem; width: 18px; height: 18px; stroke-width: 2.2; transition: color 0.25s var(--ease-out-cubic), transform 0.25s var(--ease-out-cubic); }
        .sidebar-module-link:hover {
            background-color: var(--tertiary-bg); color: var(--text-primary);
            border-color: var(--border-color); transform: translateX(4px) scale(1.015); /* Adjusted hover effect */
        }
        .sidebar-module-link:hover .lucide { transform: scale(1.05) rotate(-2deg); }
        .sidebar-module-link:active {
            transform: translateX(2px) scale(0.99);
            background-color: color-mix(in srgb, var(--tertiary-bg) 80%, var(--border-color) 20%);
        }
        .sidebar-module-link:focus-visible {
            outline: 2px solid var(--accent-primary); outline-offset: -1px;
            background-color: var(--tertiary-bg); color: var(--text-primary);
            border-color: var(--accent-primary); box-shadow: 0 0 8px var(--accent-primary-glow);
        }
        .sidebar-module-link.active {
            background: linear-gradient(95deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            color: white !important; font-weight: 600;
            box-shadow: 0 7px 22px var(--accent-primary-glow), 0 4px 12px var(--accent-secondary-glow); /* Enhanced shadow */
            transform: translateX(4px) scale(1.025);
        }
        .sidebar-module-link.active .lucide { color: white !important; transform: scale(1.1); }
        .sidebar-module-link.active:focus-visible {
            box-shadow: 0 7px 22px var(--accent-primary-glow), 0 4px 12px var(--accent-secondary-glow), 0 0 0 2px var(--primary-bg), 0 0 0 4px var(--accent-primary-hover);
        }

        /* Progress Bar & Text */
        .sidebar-module-link .module-progress-container { margin-left: auto; display: flex; align-items: center; gap: 0.6rem; }
        .sidebar-module-link .module-progress {
            display: flex; align-items: center;
            background-color: color-mix(in srgb, var(--tertiary-bg) 60%, transparent); /* More subtle bg */
            padding: 2px; border-radius: 0.3rem; width: 50px; height: 16px; position: relative;
        }
        .sidebar-module-link .module-progress-bar-inner {
            height: 100%; background-image: linear-gradient(90deg, var(--accent-green), var(--accent-green-hover));
            border-radius: 0.2rem; width: 0%;
            transition: width 0.9s var(--ease-in-out-cubic); /* Smoother fill */
            box-shadow: 0 0 6px color-mix(in srgb, var(--accent-green) 40%, transparent);
        }
        .sidebar-module-link .module-progress-text {
            font-size: 0.7rem; font-weight: 600; line-height: 1;
            color: var(--text-primary); mix-blend-mode: exclusion;
            transition: color 0.3s var(--ease-out-cubic); flex-shrink: 0;
        }
        .sidebar-module-link .module-progress-text.progress-empty { color: var(--text-secondary); mix-blend-mode: normal; }
        body[class*="light-"] .sidebar-module-link .module-progress-text { color: var(--text-primary); mix-blend-mode: normal; }
        body[class*="light-"] .sidebar-module-link .module-progress-text.progress-empty { color: var(--text-secondary); mix-blend-mode: normal; }
        .sidebar-module-link.active .module-progress-container .module-progress-text,
        .sidebar-module-link.active .module-progress-container .module-progress-text.progress-empty { color: white; mix-blend-mode: normal; }
        .sidebar-module-link.module-complete-visual .module-progress-text { color: color-mix(in srgb, var(--primary-bg) 90%, black); }
        body[class*="light-"] .sidebar-module-link.module-complete-visual .module-progress-text { color: white; }
        .sidebar-module-link.module-complete-visual:not(.active) .lucide { color: var(--accent-green); animation: pulseIcon 1.8s var(--ease-in-out-cubic) infinite; }

        #scroll-container { flex-grow: 1; overflow-y: auto; height: 100vh; padding-left: 290px; }
        .section-padding { padding: 7rem 5rem; }

        /* Mobile Responsiveness */
        @media (max-width: 1024px) {
            .section-padding { padding: 5rem 2rem; }
            #sticky-sidebar-nav {
                width: 100%; height: auto; position: relative; z-index: 101;
                border-right: none; border-bottom: 1px solid var(--border-color);
                padding-bottom: 1rem;
            }
            #module-navigation-list { flex-direction: row; overflow-x: auto; padding-bottom: 0.5rem; gap: 0.5rem; }
            .sidebar-module-link { flex: 0 0 auto; white-space: nowrap; }
            #scroll-container { padding-left: 0; }
            #app-wrapper { flex-direction: column; }
        }
        @media (max-width: 640px) {
            .section-padding { padding: 4rem 1rem; }
            .lesson-block { padding: 2rem 1.5rem; }
            #hero-section h2 { font-size: clamp(2rem, 10vw, 3.5rem); }
            #hero-section .hero-subtitle { font-size: clamp(1rem, 4vw, 1.25rem); }
            .module-title-main { font-size: clamp(2rem, 8vw, 3.5rem); }
            .lesson-block #lesson-title { font-size: clamp(1.5rem, 6vw, 2.25rem); }
        }

        /* Hero Section */
        #hero-section {
            min-height: 95vh; display: flex; flex-direction: column;
            justify-content: center; align-items: center; text-align: center; position: relative;
        }
        #hero-section h2 {
            font-size: clamp(2.5rem, 8vw, 4.8rem); /* Slightly adjusted max size */
            font-weight: 900; letter-spacing: -0.05em; line-height: 1.05; margin-bottom: 2rem;
            background: linear-gradient(125deg, var(--accent-primary-hover) 10%, var(--accent-secondary-hover) 50%, #FFD700 85%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            animation: textShine 7s var(--ease-in-out-cubic) infinite, fadeInSlideUpInitial 1s var(--ease-out-quart) 0.2s backwards; /* Slower shine, initial anim */
            background-size: 300% auto;
        }
        #hero-section .hero-subtitle {
            font-size: clamp(1.1rem, 3.5vw, 1.5rem); /* Slightly adjusted */
            color: var(--text-secondary); max-width: 720px; /* Adjusted width */
            margin-bottom: 3.5rem; line-height: 1.75; /* Increased line height */
            animation: fadeInSlideUpInitial 1s var(--ease-out-quart) 0.4s backwards; /* Staggered delay */
        }
        #hero-section .scroll-down-indicator {
            position: absolute; bottom: 2.5rem; /* Slightly higher */
            animation: heroScrollIndicatorFloat 2.5s var(--ease-in-out-cubic) infinite 1.2s, fadeInSlideUpInitial 1s var(--ease-out-quart) 0.7s backwards; /* Refined animation */
        }
        #hero-section .scroll-down-indicator .lucide { width: 38px; height: 38px; color: var(--accent-primary); }

        /* Module Sections & Content Blocks */
        .module-section {
            min-height: 100vh; border-bottom: 1px solid var(--border-color);
            display: flex; flex-direction: column; justify-content: center;
            transition: border-color 0.4s var(--ease-in-out-cubic);
        }
        .module-section:last-of-type { border-bottom: none; }

        .module-header { text-align: center; margin-bottom: 5rem; } /* Slightly less margin */
        .module-title-main-wrapper { overflow: hidden; }
        .module-title-main {
            font-size: clamp(2.2rem, 7vw, 4.5rem); font-weight: 800; letter-spacing: -0.04em;
            margin-bottom: 0.8rem; color: var(--text-primary);
            display: inline-block; transform: translateY(100%); opacity: 0;
            transition: color 0.4s var(--ease-in-out-cubic);
        }
        @keyframes revealModuleTitle { /* Specific animation for module titles */
            from { opacity: 0; transform: translateY(80px) scale(0.95); } /* Start further down and smaller */
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        .module-header.is-visible .module-title-main {
            animation: revealModuleTitle 0.9s var(--ease-out-quart) forwards; /* More refined easing */
        }
        .module-description {
            font-size: 1.15rem; color: var(--text-secondary); max-width: 680px;
            margin: 0 auto 1.3rem auto;
            transition: color 0.4s var(--ease-in-out-cubic);
        }

        .lesson-block {
            background-color: color-mix(in srgb, var(--secondary-bg) 65%, transparent); /* Slightly more opaque */
            border: 1px solid var(--border-color);
            border-radius: 1.25rem; /* Consistent radius */
            padding: 2.8rem 3.2rem; /* Adjusted padding */
            margin-bottom: 3.5rem; /* Adjusted margin */
            box-shadow: var(--card-shadow); /* Uses variable */
            opacity: 0;
            transition: opacity 0.8s var(--ease-out-quart), transform 0.8s var(--ease-out-quart), background-color 0.4s var(--ease-in-out-cubic), border-color 0.4s var(--ease-in-out-cubic), box-shadow 0.4s var(--ease-in-out-cubic);
        }
        .lesson-block.is-visible {
            opacity: 1;
            transform: translateY(0) scale(1); /* Added scale for a subtle pop */
        }
        .animate-on-scroll.lesson-block { /* Initial state for lesson blocks */
             transform: translateY(50px) scale(0.97);
        }


        .lesson-block #lesson-title {
            font-size: clamp(1.7rem, 4.5vw, 2.8rem); font-weight: 700;
            letter-spacing: -0.03em; color: var(--text-interactive);
            margin-bottom: 1.8rem;
            transition: color 0.4s var(--ease-in-out-cubic);
        }
        .lesson-block #lesson-instruction { color: var(--text-secondary); line-height: 1.8; font-size: 1.05rem; transition: color 0.4s var(--ease-in-out-cubic); }
        .lesson-block #lesson-instruction strong { color: var(--text-primary); font-weight: 600; transition: color 0.4s var(--ease-in-out-cubic); }
        .lesson-block #lesson-instruction code {
            background-color: var(--tertiary-bg); color: var(--accent-primary);
            padding: 0.25rem 0.5rem; border-radius: 0.4rem; /* Adjusted padding/radius */
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;
            border: 1px solid var(--border-color);
            transition: background-color 0.4s var(--ease-in-out-cubic), color 0.4s var(--ease-in-out-cubic), border-color 0.4s var(--ease-in-out-cubic);
        }
        .lesson-block #lesson-instruction ul li::marker { color: var(--accent-primary); transition: color 0.4s var(--ease-in-out-cubic); font-size: 1.2em; }

        .lesson-block #lesson-example {
            background-color: color-mix(in srgb, var(--border-color) 15%, transparent); /* More subtle */
            border: 1px solid var(--border-color);
            padding: 1.5rem; border-radius: 0.85rem; margin-top: 1.8rem;
            transition: background-color 0.4s var(--ease-in-out-cubic), border-color 0.4s var(--ease-in-out-cubic);
        }
        .lesson-block #lesson-example h5 { color: var(--text-primary); font-weight: 600; font-size: 1rem; transition: color 0.4s var(--ease-in-out-cubic); }
        .lesson-block #lesson-example p { font-size: 0.9rem; color: var(--text-secondary); transition: color 0.4s var(--ease-in-out-cubic); }

        .lesson-block #quiz-area { border-top: 1px solid var(--border-color); margin-top: 2.5rem; padding-top: 2.5rem; transition: border-color 0.4s var(--ease-in-out-cubic);}
        .lesson-block #quiz-question-title { color: var(--text-primary); font-weight: 700; font-size: 1.2rem; transition: color 0.4s var(--ease-in-out-cubic);}
        .lesson-block #quiz-question { color: var(--text-primary); font-size: 1.1rem; font-weight: 500; margin-bottom: 1.5rem; transition: color 0.4s var(--ease-in-out-cubic);}

        .lesson-block .lesson-option {
            background-color: var(--tertiary-bg); border: 2px solid var(--border-color); color: var(--text-primary);
            transition: all 0.25s var(--ease-out-cubic); /* Smoother transition */
            border-radius: 0.75rem; padding: 1rem 1.25rem; font-weight: 500;
            position:relative; cursor: pointer;
        }
        .lesson-block .lesson-option:hover:not(:disabled) {
            background-color: var(--border-color); border-color: var(--accent-primary);
            transform: translateY(-3px) scale(1.015); /* Adjusted hover */
            box-shadow: 0 6px 18px color-mix(in srgb, var(--card-shadow) 40%, transparent);
        }
        .lesson-block .lesson-option:active:not(:disabled) {
            transform: translateY(-1px) scale(0.985); /* Adjusted active */
            box-shadow: 0 3px 10px color-mix(in srgb, var(--card-shadow) 30%, transparent);
        }
        .lesson-block .lesson-option:focus-visible {
            outline: 2px solid var(--accent-primary-hover);
            outline-offset: 1px;
            border-color: var(--accent-primary-hover);
            box-shadow: 0 0 0 3px color-mix(in srgb, var(--accent-primary) 25%, transparent);
        }
        .lesson-block .lesson-option.correct {
            background: linear-gradient(135deg, var(--accent-green), var(--accent-green-hover)) !important;
            border-color: var(--accent-green-hover) !important;
            color: color-mix(in srgb, var(--primary-bg) 85%, black) !important;
            font-weight: 600; transform: scale(1.02); /* Subtle scale on correct */
            animation: feedbackPop 0.4s var(--ease-out-cubic);
        }
        body[class*="light-"] .lesson-block .lesson-option.correct { color: white !important; }

        .lesson-block .lesson-option.incorrect {
            background: linear-gradient(135deg, var(--accent-red), var(--accent-red-hover)) !important;
            border-color: var(--accent-red-hover) !important;
            color: color-mix(in srgb, var(--primary-bg) 85%, black) !important;
            font-weight: 600; animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }
        body[class*="light-"] .lesson-block .lesson-option.incorrect { color: white !important; }

        .lesson-block .feedback-area-lesson p { font-weight: 500; padding: 0.75rem 1rem; border-radius: 0.5rem; animation: feedbackPop 0.4s var(--ease-out-cubic); }
        .lesson-block .feedback-area-lesson .feedback-correct {
            background-color: color-mix(in srgb, var(--accent-green) 20%, transparent);
            color: var(--accent-green-hover); border: 1px solid var(--accent-green);
            animation: feedbackCelebration 0.6s var(--ease-out-cubic);
        }
        .lesson-block .feedback-area-lesson .feedback-incorrect { background-color: color-mix(in srgb, var(--accent-red) 20%, transparent); color: var(--accent-red-hover); border: 1px solid var(--accent-red); }

        /* Visual Aid Placeholder */
        .visual-aid-placeholder {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            min-height: 250px; /* Slightly smaller */
            background-color: color-mix(in srgb, var(--tertiary-bg) 35%, transparent); /* More subtle */
            border: 2px dashed var(--border-color);
            border-radius: 1rem; padding: 2rem; text-align: center;
            transition: background-color 0.4s var(--ease-in-out-cubic), border-color 0.4s var(--ease-in-out-cubic);
        }
        .visual-aid-placeholder .lucide {
            width: 48px; height: 48px; color: var(--text-secondary); margin-bottom: 1rem;
            transition: color 0.4s var(--ease-in-out-cubic), transform 0.3s var(--ease-out-cubic);
        }
        .visual-aid-placeholder:hover .lucide { transform: scale(1.1) rotate(4deg); }
        .visual-aid-placeholder p { color: var(--text-secondary); font-style: italic; transition: color 0.4s var(--ease-in-out-cubic);}

        /* Restart Course Button */
        #restart-course-button {
            background: linear-gradient(95deg, var(--accent-primary), var(--accent-secondary));
            color: white; font-weight: 600; padding: 0.8rem 1.6rem; border-radius: 0.65rem; /* Consistent with other buttons */
            box-shadow: 0 5px 18px var(--accent-primary-glow), 0 2px 9px var(--accent-secondary-glow), inset 0 1px 1px rgba(255,255,255,0.08);
            transition: all 0.25s var(--ease-out-cubic); border: none; cursor: pointer;
        }
        #restart-course-button:hover {
            transform: translateY(-3px) scale(1.03); /* Adjusted hover */
            box-shadow: 0 7px 25px var(--accent-primary-glow), 0 4px 14px var(--accent-secondary-glow), inset 0 1px 1px rgba(255,255,255,0.1);
        }
        #restart-course-button:active {
            transform: translateY(-1px) scale(1.00); /* Adjusted active */
        }
        #restart-course-button:focus-visible {
            outline: 2px solid var(--accent-primary-hover); outline-offset: 2px;
            box-shadow: 0 7px 25px var(--accent-primary-glow), 0 4px 14px var(--accent-secondary-glow), 0 0 0 3px color-mix(in srgb, var(--accent-primary) 30%, transparent);
        }

        /* Completion Section */
        #completion-section {
            min-height: 80vh; display: flex; flex-direction: column;
            justify-content: center; align-items: center; text-align: center;
        }
        #completion-section h2 { font-size: 3rem; font-weight: 800; color: var(--accent-green-hover); transition: color 0.4s var(--ease-in-out-cubic); letter-spacing: -0.02em; }
        #completion-section p { font-size: 1.25rem; color: var(--text-secondary); margin-top: 0.7rem; transition: color 0.4s var(--ease-in-out-cubic); }
        #completion-section .lucide-party-popper { width: 80px; height: 80px; color: var(--accent-primary); margin-bottom: 1.1rem; animation: pop 0.6s var(--ease-out-cubic) forwards, tadaEnhanced 2s 0.6s var(--ease-in-out-cubic) infinite; transition: color 0.4s var(--ease-in-out-cubic);}

        /* General Animation Utility */
        .animate-on-scroll {
            opacity: 0;
            transition: opacity 0.8s var(--ease-out-quart), transform 0.8s var(--ease-out-quart);
        }
        .animate-on-scroll.slide-up { /* Base slide-up, can be overridden by more specific like lesson-block */
            transform: translateY(50px);
        }
        .animate-on-scroll.is-visible {
            opacity: 1;
            transform: translateY(0) scale(1); /* Ensure scale is reset */
        }

    </style>
</head>
<body>
    <div id="app-wrapper">
        <nav id="sticky-sidebar-nav">
            <div id="sidebar-header">
                <h1>Gemini Skills</h1>
                <p>Workspace Booster</p>
            </div>
            <div id="theme-cycler-container">
                <button id="theme-cycle-button" aria-live="polite">
                    <i data-lucide="palette"></i>
                    <span id="current-theme-name-display">Theme</span>
                </button>
            </div>
            <ul id="module-navigation-list">
                <!-- Module links will be injected here by JS -->
            </ul>
        </nav>

        <main id="scroll-container">
            <section id="hero-section" class="section-padding">
                <h2>Unlock Your AI Potential<br/>with Gemini in Workspace.</h2>
                <p class="hero-subtitle">Master the tools that redefine productivity. Scroll to begin your journey into the future of work.</p>
                <div class="scroll-down-indicator">
                    <i data-lucide="arrow-down-circle"></i>
                </div>
            </section>

            <!-- Module and Lesson content will be injected here by JS -->

            <section id="completion-section" class="section-padding hidden">
                <i data-lucide="party-popper"></i>
                <h2>Course Completed!</h2>
                <p>Congratulations! You've mastered the Gemini Workspace Skills Booster.</p>
                <button id="restart-course-button" class="mt-8 text-base">
                    Restart Course
                </button>
            </section>
        </main>
    </div>

<script>
// Ensure Lucide icons are replaced after DOM content is loaded
function replaceLucideIcons() {
    setTimeout(() => {
        if (typeof lucide !== 'undefined') {
            lucide.createIcons();
        } else {
            console.warn("Lucide library not loaded yet for icon replacement.");
            setTimeout(() => {
                if (typeof lucide !== 'undefined') { lucide.createIcons(); }
                else { console.error("Lucide library failed to load for icon replacement."); }
            }, 600);
        }
    }, 100);
}


document.addEventListener('DOMContentLoaded', () => {
    const courseData = [
        {
            moduleId: "gemini-fundamentals",
            moduleTitle: "Gemini: The Foundation",
            moduleDescription: "Grasp the core concepts of Gemini and its transformative power in your daily Google Workspace tasks.",
            moduleIcon: "atom",
            lessons: [
                {
                    lessonId: "fundamentals-1",
                    title: "Meet Gemini: Your AI Partner",
                    instruction: `<p>Gemini for Google Workspace isn't just a tool; it's your intelligent partner, seamlessly integrated into Gmail, Docs, Sheets, Slides, Meet, and Chat. Its mission is to amplify your productivity, spark creativity, and streamline complex enterprise workflows.</p><p><strong>Core Capabilities at a Glance:</strong></p><ul><li><strong>Intelligent Content Creation:</strong> Effortlessly draft professional emails, insightful documents, and compelling presentations.</li><li><strong>Insightful Summarization:</strong> Distill lengthy texts, cluttered email threads, or extensive meeting transcripts into concise, actionable summaries.</li><li><strong>Dynamic Brainstorming:</strong> Generate a wealth of ideas for innovative projects, impactful campaigns, or effective problem-solving strategies.</li><li><strong>Advanced Data Analysis (Sheets):</strong> Simplify complex data tasks by getting help with formulas, data interpretation, and table construction.</li><li><strong>Streamlined Workflows:</strong> Automate repetitive tasks and receive smart suggestions that anticipate your needs.</li></ul><p>Built on Google's robust AI Principles, Gemini prioritizes safety, fairness, and data privacy—paramount in any enterprise setting.</p>`,
                    example: `Imagine you're a marketing lead. Gemini can help draft a campaign launch announcement in Gmail, outline a strategy document in Docs, build a performance tracker in Sheets for key metrics, and generate initial slide content for a results presentation in Slides.`,
                    quiz: {
                        question: "Which of these best describes Gemini's role in Google Workspace according to the lesson?",
                        options: [
                            "A standalone AI application for specialized tasks.",
                            "An intelligent partner integrated across apps to boost productivity and creativity.",
                            "A tool primarily for automating calendar management.",
                            "A replacement for human collaboration in projects."
                        ],
                        correctAnswer: "An intelligent partner integrated across apps to boost productivity and creativity."
                    },
                    completed: false
                },
                {
                    lessonId: "fundamentals-2",
                    title: "Accessing Gemini: UI & Interactions",
                    instruction: `<p>Gemini's intelligence is woven into the fabric of each Workspace app, making its features intuitive to access. Familiarize yourself with these common interaction points:</p><ul><li>✨ **The Sparkle Icon:** This ubiquitous symbol is your primary cue for Gemini-powered features, often found on buttons or within toolbars, inviting you to leverage AI.</li><li><strong>Contextual Action Buttons:</strong> Look for explicit prompts like 'Help me write,' 'Help me organize,' or 'Help me visualize.' These buttons trigger specific Gemini capabilities tailored to your current task.</li><li><strong>Dedicated Side Panels/Panes:</strong> Certain applications may offer a persistent Gemini panel, providing ongoing assistance and a conversational interface.</li><li><strong>@-Mentions for Quick Actions:** In collaborative environments like Docs or Chat, typing <code>@gemini</code> followed by your request can often invoke direct AI actions.</li></ul><p>Note: The precise appearance and availability of Gemini features can be influenced by your enterprise administrator's settings and ongoing Google updates.</p>`,
                    example: `In Google Docs, clicking a ✨ button might offer to draft the next paragraph or summarize a section. In Gmail, a 'Summarize this thread' button with the sparkle icon could appear above lengthy conversations. Within Sheets, a dedicated Gemini side panel could help you generate complex formulas from natural language queries.`,
                    quiz: {
                        question: "What is a primary visual indicator for Gemini-powered features within Google Workspace applications?",
                        options: [
                            "A magnifying glass icon for search.",
                            "The sparkle icon (✨) on buttons or in toolbars.",
                            "A settings gear icon for configuration.",
                            "A cloud upload icon for saving."
                        ],
                        correctAnswer: "The sparkle icon (✨) on buttons or in toolbars."
                    },
                    completed: false
                },
                {
                    lessonId: "fundamentals-3",
                    title: "Responsible AI: Trust & Privacy",
                    instruction: `<p>Leveraging AI in an enterprise environment demands an unwavering commitment to responsibility, data security, and ethical use. Google has engineered Gemini for Workspace with these foundational principles:</p><ul><li><strong>Your Data Remains Yours:</strong> Crucially, your company's proprietary data (emails, documents, spreadsheets, etc.) is <strong>not</strong> used to train Google's general foundation models that serve other customers or the public. You maintain full ownership and control.</li><li><strong>You Are in Command:</strong> Gemini acts as an assistant, providing intelligent suggestions and drafts. However, <strong>you</strong> always retain ultimate control. Every piece of AI-generated content requires your review, critical editing, and explicit approval before use or distribution.</li><li><strong>The Imperative of Fact-Checking:</strong> Generative AI, while powerful, can occasionally produce inaccuracies or incomplete information (often termed 'hallucinations'). It is vital to critically evaluate all of Gemini's outputs, especially those involving factual claims or data-sensitive operations. Always cross-verify information with trusted, reliable sources.</li><li><strong>Cultivating Bias Awareness:</strong> AI models learn from vast datasets, which may inadvertently reflect existing societal biases. Be vigilant and mindful of potential biases in generated content. Strive for fairness, equity, and inclusivity in all your final work produced with AI assistance.</li></ul><p>Furthermore, ensure you are well-versed in your organization's specific policies and guidelines regarding the use of artificial intelligence tools.</p>`,
                    example: `If Gemini assists in drafting a market analysis report in Google Docs, your responsibility is to meticulously verify every statistic, claim, and projection against your company's internal data, validated industry reports, or other authoritative sources before presenting the report to stakeholders or making decisions based on it.`,
                    imagePrompt: "An abstract image representing data security and trust. Perhaps a stylized shield or a secure lock icon with digital circuit patterns, against a backdrop that conveys professionalism and safety. Colors should be reassuring, maybe blues and greens, with a modern tech feel.",
                    quiz: {
                        question: "What is Google's stance on using your enterprise data with Gemini in Workspace for training general AI models available to other customers?",
                        options: [
                            "All enterprise data is used to improve AI for everyone, after anonymization.",
                            "Your enterprise data is NOT used to train general models for other customers; you retain control.",
                            "Data is only used if an administrator explicitly opts-in the entire organization.",
                            "Only non-sensitive documents are used for general model training."
                        ],
                        correctAnswer: "Your enterprise data is NOT used to train general models for other customers; you retain control."
                    },
                    completed: false
                },
            ]
        },
        {
            moduleId: "gemini-gmail",
            moduleTitle: "Gmail: AI-Powered Email",
            moduleDescription: "Revolutionize your inbox. Learn to draft, summarize, and manage emails with unparalleled AI efficiency in Gmail.",
            moduleIcon: "mail-check",
            lessons: [
                {
                    lessonId: "gmail-1",
                    title: "Rapid Email Drafting: 'Help me write'",
                    instruction: `<p>The 'Help me write' feature in Gmail, supercharged by Gemini, dramatically accelerates email composition. Simply provide a prompt, and Gemini crafts a contextual draft, saving you valuable time.</p><p><strong>Leveraging 'Help me write':</strong></p><ol><li>Initiate a new email or reply. Locate and click the 'Help me write' button (often distinguished by a ✨ icon).</li><li>In the prompt field, articulate your email's objective, intended recipient, key information, and desired tone. Specificity yields better results.</li><li>Gemini generates a draft. You then have several refinement options:<ul><li><strong>Insert:</strong> Seamlessly integrate the draft into your email compose window.</li><li><strong>Recreate:</strong> Request a new draft, possibly after refining your initial prompt for better clarity or a different angle.</li><li><strong>Refine Options:</strong> Utilize built-in tools like 'Formalize,' 'Elaborate,' 'Shorten,' or 'Summarize' to fine-tune the draft. You can also provide custom textual instructions for more nuanced adjustments.</li></ul></li></ol><p>Ethical Reminder: Always meticulously review and edit any AI-generated draft for accuracy, appropriate tone, and completeness before sending any communication.</p>`,
                    example: `Your prompt for 'Help me write': 'Draft a professional email to the "Project Alpha Team", cc'ing "manager@example.com". Congratulate them on the successful launch of Project Alpha. Specifically mention their dedication and the positive client feedback received regarding the new UI. Politely request their preparation for a post-launch review meeting scheduled for next Tuesday at 10 AM.'`,
                    imagePrompt: "A clean mock-up of the Gmail compose window. The 'Help me write ✨' button is subtly highlighted. A conceptual text bubble shows a user typing a detailed prompt. The generated email draft appears below, looking professional. Focus on clarity and a modern, uncluttered interface.",
                    quiz: {
                        question: "When using Gemini's 'Help me write' in Gmail, which action is essential *before* sending the email?",
                        options: [
                            "Immediately clicking 'Send' to save time.",
                            "Asking Gemini to send it automatically.",
                            "Thoroughly reviewing and editing the draft for accuracy, tone, and completeness.",
                            "Shortening the draft, regardless of its initial quality."
                        ],
                        correctAnswer: "Thoroughly reviewing and editing the draft for accuracy, tone, and completeness."
                    },
                    completed: false
                },
                {
                    lessonId: "gmail-2",
                    title: "Conquer Email Overload: Thread Summaries",
                    instruction: `<p>Effortlessly navigate long and complex email threads with Gemini's intelligent summarization feature in Gmail. This capability is invaluable for quickly grasping context, key decisions, and outstanding action items without needing to read every single message.</p><p><strong>How Thread Summarization Works:</strong></p><ul><li>For lengthy or eligible email threads, a 'Summarize' button (often accompanied by the ✨ icon) will typically appear at the top of the conversation.</li><li>Clicking this button prompts Gemini to analyze the thread and generate a concise summary of its most critical points.</li><li>The summary usually highlights the main topics discussed, significant decisions made, any unresolved questions, and assigned action items.</li></ul><p>This feature is particularly beneficial when: onboarding to an ongoing project, catching up after a period of absence, or needing a rapid understanding of a thread's essentials before a meeting or making a decision.</p>`,
                    example: `You've just been added to an email chain with over 50 replies debating crucial Q4 budget allocations. Instead of dedicating an hour to manual reading, you click 'Summarize.' Gemini swiftly provides a 4-bullet point overview: 1. Initial proposal: 20% budget cut across all departments. 2. Marketing & R&D raised concerns about impact on innovation and Q1 campaigns. 3. Finance proposed tiered cuts: 10% for core operations, 15% for discretionary, 5% for strategic growth areas. 4. Consensus pending on final percentages for strategic growth.`,
                    imagePrompt: "An abstract visual representation of a tangled, complex line (representing an email thread) being neatly unraveled and transformed into a series of clear, concise bullet points. A subtle Gemini sparkle icon should be part of the transformation effect. Use a dark, tech-inspired background with cyan and magenta highlights.",
                    quiz: {
                        question: "What is the primary advantage of using Gemini to summarize email threads in Gmail?",
                        options: [
                            "It automatically replies to all unread emails in the thread.",
                            "It allows you to quickly understand the core information and key takeaways from long conversations without reading every email.",
                            "It translates the entire email thread into multiple languages simultaneously.",
                            "It permanently archives the original emails after creating a summary."
                        ],
                        correctAnswer: "It allows you to quickly understand the core information and key takeaways from long conversations without reading every email."
                    },
                    completed: false
                }
            ]
        },
        {
            moduleId: "gemini-slides",
            moduleTitle: "Slides: AI-Enhanced Presentations",
            moduleDescription: "Design compelling presentations with AI assistance for outlines, content, and unique visuals in Google Slides.",
            moduleIcon: "presentation",
            lessons: [
                {
                    lessonId: "slides-1",
                    title: "Kickstart Your Story: Outline & Content Generation",
                    instruction: `<p>Overcome the blank-slide challenge with Gemini in Google Slides. It can be your creative partner, generating structured outlines and drafting initial content to get your presentation off to a flying start.</p><p><strong>How Gemini Ignites Your Presentation:</strong></p><ol><li>Begin a new presentation or open an existing one.</li><li>Access Gemini, typically through a 'Help me create' button or the ✨ icon.</li><li>Provide a clear prompt detailing your presentation's topic, target audience, desired length (e.g., number of slides), and key sections or messages you want to include. Examples:<ul><li>'Generate a 7-slide presentation outline for a workshop on "Effective Time Management for Remote Teams".'</li><li>'Draft compelling content for an introductory slide about our company's new sustainability initiative, targeting potential investors.'</li><li>'Suggest three key talking points and a powerful call to action for a presentation on the benefits of our new SaaS product.'</li></ul></li><li>Gemini will propose an outline or draft content. You can then insert this into your slides and begin the process of refining, adding your unique insights, customizing visuals, and ensuring brand alignment.</li></ol><p>This AI-assisted approach provides a robust foundation, saving you time and sparking further ideas for a polished and impactful presentation.</p>`,
                    example: `Your prompt: 'Create a comprehensive outline for a 20-minute internal presentation to new software engineers about our company's coding standards and development lifecycle. Key sections should include: Introduction to our philosophy, Version Control (Git), Code Review Process, Testing Pyramid, Deployment Pipeline, and Q&A.' Gemini will then generate a detailed slide-by-slide structural outline.`,
                    imagePrompt: "A visual metaphor of an AI (represented by a subtle, glowing circuit pattern or a sparkle icon) constructing a presentation slide by slide. Show an empty slide transforming into a structured one with title, bullet points, and a placeholder for an image. Use a dynamic, slightly isometric perspective. Dark background with cyan and magenta accents.",
                    quiz: {
                        question: "How does Gemini primarily assist in the initial creation phase of a Google Slides presentation?",
                        options: [
                            "By automatically selecting the final color theme and font pairings.",
                            "By delivering the presentation to a pre-defined audience list.",
                            "By generating structured presentation outlines and drafting initial content for slides based on user prompts.",
                            "By exclusively inserting images from a restricted internal company library."
                        ],
                        correctAnswer: "By generating structured presentation outlines and drafting initial content for slides based on user prompts."
                    },
                    completed: false
                },
            ]
        }
    ];

    const scrollContainer = document.getElementById('scroll-container');
    const moduleNavList = document.getElementById('module-navigation-list');
    const completionSection = document.getElementById('completion-section');
    const restartCourseButton = document.getElementById('restart-course-button');
    const themeCycleButton = document.getElementById('theme-cycle-button');
    const currentThemeNameDisplay = document.getElementById('current-theme-name-display');

    const themes = ['dark-zenith', 'light-zenith'];
    const themeFriendlyNames = {
        'dark-zenith': "Dark Mode: Active",
        'light-zenith': "Light Mode: Active"
    };
    let currentThemeIndex = 0; // Default to Dark Zenith


    // --- Theme Toggle ---
    function applyTheme(themeName, isInitialLoad = false) {
        document.body.className = '';
        document.body.classList.add(`theme-${themeName}`);

        if (currentThemeNameDisplay) {
            currentThemeNameDisplay.textContent = themeFriendlyNames[themeName] || "Unknown Theme";
        }

        try {
            localStorage.setItem('geminiSkillsThemeIndex', currentThemeIndex.toString());
        } catch (e) { console.warn("Could not save theme preference."); }
        replaceLucideIcons(); // Call after theme class is set to allow icon colors to update
    }

    if (themeCycleButton) {
        themeCycleButton.addEventListener('click', () => {
            currentThemeIndex = (currentThemeIndex + 1) % themes.length;
            applyTheme(themes[currentThemeIndex]);
        });
    }

    function loadSavedTheme() {
        let savedThemeIdx = 0;
        try {
            const storedThemeIdx = localStorage.getItem('geminiSkillsThemeIndex');
            if (storedThemeIdx !== null) {
                savedThemeIdx = parseInt(storedThemeIdx, 10);
                if (isNaN(savedThemeIdx) || savedThemeIdx < 0 || savedThemeIdx >= themes.length) {
                    savedThemeIdx = 0;
                }
            }
        } catch (e) { console.warn("Could not load theme preference."); }
        currentThemeIndex = savedThemeIdx;
        applyTheme(themes[currentThemeIndex], true);
    }

    // --- Animation Observer ---
    const animationObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('is-visible');
                // Optional: unobserve after first animation if not needed for re-animation on scroll
                // observer.unobserve(entry.target);
            } else {
                // Optional: remove 'is-visible' if you want animations to replay on scroll up/down
                // entry.target.classList.remove('is-visible');
            }
        });
    }, { threshold: 0.15 }); // Adjust threshold as needed (0.15 means 15% of element is visible)

    function observeElements(selector) {
        document.querySelectorAll(selector).forEach(el => {
            animationObserver.observe(el);
        });
    }

    // --- UI RENDERING ---
    function renderCourse() {
        if (!moduleNavList || !scrollContainer || !completionSection) {
            console.error("Core UI elements for rendering course are missing.");
            return;
        }
        moduleNavList.innerHTML = '';
        // Clear existing module sections before re-rendering
        Array.from(scrollContainer.querySelectorAll('.module-section')).forEach(el => el.remove());

        courseData.forEach((module, moduleIdx) => {
            const li = document.createElement('li');
            const link = document.createElement('a');
            link.href = `#module-${module.moduleId}`;
            link.className = 'sidebar-module-link';
            link.innerHTML = `
                <i data-lucide="${module.moduleIcon || 'book-open'}"></i>
                <span>${module.moduleTitle}</span>
                <div class="module-progress-container">
                    <div class="module-progress" id="progress-container-${module.moduleId}" title="${module.moduleTitle} Progress">
                        <div class="module-progress-bar-inner" id="progress-bar-${module.moduleId}"></div>
                    </div>
                    <span class="module-progress-text" id="progress-text-${module.moduleId}">0%</span>
                </div>
            `;
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const targetSection = document.querySelector(link.getAttribute('href'));
                if (targetSection) {
                    targetSection.scrollIntoView({ behavior: 'smooth' });
                }
                updateActiveModuleNav(`module-${module.moduleId}`);
            });
            li.appendChild(link);
            moduleNavList.appendChild(li);

            const moduleSection = document.createElement('section');
            moduleSection.id = `module-${module.moduleId}`;
            moduleSection.className = 'module-section section-padding'; // Base classes

            let moduleHTML = `
                <div class="module-header animate-on-scroll">
                    <div class="module-title-main-wrapper">
                        <h3 class="module-title-main">${module.moduleTitle}</h3>
                    </div>
                    <p class="module-description">${module.moduleDescription || ''}</p>
                </div>
            `;

            module.lessons.forEach((lesson, lessonIdx) => {
                const isLastLessonOverall = (moduleIdx === courseData.length - 1) && (lessonIdx === module.lessons.length - 1);
                // Add 'animate-on-scroll' to lesson blocks for staggered animation
                moduleHTML += `
                    <div class="lesson-block animate-on-scroll" data-module-index="${moduleIdx}" data-lesson-index="${lessonIdx}" style="transition-delay: ${lessonIdx * 100}ms;">
                        <h4 id="lesson-title">${lesson.title}</h4>

                        ${lesson.imagePrompt ? `
                        <div id="visual-aid-section" class="mb-6">
                            <div class="visual-aid-container-lesson visual-aid-placeholder my-4">
                                <i data-lucide="image"></i>
                                <p>Visual content to enhance this lesson.</p>
                            </div>
                        </div>` : ''}

                        <div id="lesson-instruction" class="prose prose-sm sm:prose lg:prose-lg xl:prose-xl max-w-none mb-6">${lesson.instruction}</div>
                        ${lesson.example ? `
                        <div id="lesson-example" class="p-4 rounded-lg mb-6">
                            <h5 class="font-semibold text-sm mb-2 flex items-center"><i data-lucide="lightbulb" class="mr-2 h-4 w-4 text-yellow-400"></i>Example:</h5>
                            <p class="text-xs">${lesson.example}</p>
                        </div>` : ''}
                        ${lesson.quiz ? `
                        <div id="quiz-area" class="mt-6 pt-4 border-t border-[var(--border-color)]">
                            <h5 id="quiz-question-title" class="text-md font-semibold mb-3 flex items-center"><i data-lucide="help-circle" class="mr-2 h-5 w-5 text-[var(--accent-primary)]"></i>Test Your Knowledge:</h5>
                            <p id="quiz-question" class="mb-4">${lesson.quiz.question}</p>
                            <div class="quiz-options-lesson grid grid-cols-1 sm:grid-cols-2 gap-3">
                                ${lesson.quiz.options.map(opt => `<button class="lesson-option">${opt}</button>`).join('')}
                            </div>
                            <div class="feedback-area-lesson mt-4">
                                <p class="feedback-message-lesson text-xs p-2 rounded-md" style="display:none;"></p>
                            </div>
                        </div>` : `<div class="my-4 p-3 bg-[var(--tertiary-bg)] rounded-md text-sm text-[var(--text-secondary)] transition-colors duration-500"><i data-lucide="info" class="inline w-4 h-4 mr-2"></i>This lesson is informational. No quiz.</div>`}
                        <div class="next-lesson-button-container mt-6 text-right" data-is-last-overall="${isLastLessonOverall}"></div>
                    </div>
                `;
            });
            moduleSection.innerHTML = moduleHTML;
            // Insert before the completion section
            scrollContainer.insertBefore(moduleSection, completionSection);
        });

        addEventListenersToLessons();
        updateAllModuleProgressDisplays();
        replaceLucideIcons();
        // Observe all elements marked with 'animate-on-scroll'
        observeElements('.animate-on-scroll');
    }

    function updateActiveModuleNav(visibleModuleId) {
        document.querySelectorAll('.sidebar-module-link').forEach(link => {
            if (link.getAttribute('href') === `#${visibleModuleId}`) {
                link.classList.add('active');
            } else {
                link.classList.remove('active');
            }
        });
    }

    const moduleObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                updateActiveModuleNav(entry.target.id);
            }
        });
    }, { root: scrollContainer, threshold: 0.4, rootMargin: "-40% 0px -40% 0px" });

    function observeModuleSections() {
        document.querySelectorAll('.module-section').forEach(section => {
            moduleObserver.observe(section);
        });
    }

    function addEventListenersToLessons() {
        document.querySelectorAll('.lesson-block').forEach(lessonBlock => {
            const moduleIndex = parseInt(lessonBlock.dataset.moduleIndex);
            const lessonIndex = parseInt(lessonBlock.dataset.lessonIndex);
            const lesson = courseData[moduleIndex].lessons[lessonIndex];

            if (lesson.quiz) {
                const quizOptionsContainer = lessonBlock.querySelector('.quiz-options-lesson');
                const optionButtons = quizOptionsContainer.querySelectorAll('.lesson-option');
                const feedbackMessageEl = lessonBlock.querySelector('.feedback-message-lesson');
                const nextButtonContainer = lessonBlock.querySelector('.next-lesson-button-container');

                optionButtons.forEach(button => {
                    button.onclick = () => {
                        handleQuizOptionSelect(button, button.textContent, lesson, optionButtons, feedbackMessageEl, nextButtonContainer, moduleIndex, lessonIndex);
                    };
                });
                if(lesson.completed){
                    feedbackMessageEl.innerHTML = '<strong>Lesson Completed!</strong> You can review or scroll on.';
                    feedbackMessageEl.className = 'feedback-message-lesson text-xs p-2 rounded-md feedback-correct';
                    feedbackMessageEl.style.display = 'block';
                    optionButtons.forEach(btn => {
                        btn.disabled = true;
                        if (btn.textContent === lesson.quiz.correctAnswer) btn.classList.add('correct');
                    });
                    showNextOrComplete(nextButtonContainer, moduleIndex, lessonIndex, true);
                } else {
                     feedbackMessageEl.style.display = 'none';
                }
            } else {
                const nextButtonContainer = lessonBlock.querySelector('.next-lesson-button-container');
                if (!lesson.completed) {
                    lesson.completed = true;
                    updateModuleProgressDisplay(courseData[moduleIndex].moduleId);
                    checkOverallCompletion();
                }
                showNextOrComplete(nextButtonContainer, moduleIndex, lessonIndex, true);
            }
        });
    }

    function handleQuizOptionSelect(selectedButtonEl, selectedAnswer, lesson, allOptionButtons, feedbackEl, nextBtnContainer, moduleIdx, lessonIdx) {
        allOptionButtons.forEach(btn => btn.disabled = true);
        feedbackEl.style.display = 'block';

        if (selectedAnswer === lesson.quiz.correctAnswer) {
            feedbackEl.innerHTML = '<strong>Correct!</strong> Splendid work.';
            feedbackEl.className = 'feedback-message-lesson text-xs p-2 rounded-md feedback-correct';
            selectedButtonEl.classList.add('correct');
            lesson.completed = true;
        } else {
            feedbackEl.innerHTML = `<strong>Not quite.</strong> The correct answer: "<em>${lesson.quiz.correctAnswer}</em>". Keep learning!`;
            feedbackEl.className = 'feedback-message-lesson text-xs p-2 rounded-md feedback-incorrect';
            selectedButtonEl.classList.add('incorrect');
            allOptionButtons.forEach(btn => {
                if (btn.textContent === lesson.quiz.correctAnswer) {
                    btn.classList.add('correct');
                }
            });
        }
        showNextOrComplete(nextBtnContainer, moduleIdx, lessonIdx, lesson.completed);
        updateModuleProgressDisplay(courseData[moduleIdx].moduleId);
        if(lesson.completed) {
            checkOverallCompletion();
        }
    }

    function showNextOrComplete(container, currentModuleIdx, currentLessonIdx, isLessonConsideredComplete) {
        if (!container) return;
        container.innerHTML = '';
        const isLastLessonOverall = container.dataset.isLastOverall === "true";

        const p = document.createElement('p');
        p.className = 'font-semibold mt-4 text-sm';

        if (isLessonConsideredComplete) {
            p.classList.add('text-[var(--accent-green-hover)]');
            p.innerHTML = 'Lesson Complete! <i data-lucide="check-circle" class="inline w-4 h-4 animate-check"></i> ';

            if (isLastLessonOverall) {
                p.innerHTML += ' This is the final lesson!';
            } else {
                 const currentModule = courseData[currentModuleIdx];
                 if (currentLessonIdx === currentModule.lessons.length - 1) {
                    p.innerHTML += 'Module Finished! Scroll to the next one or use the sidebar.';
                 } else {
                    p.innerHTML += 'Scroll down for the next lesson.';
                 }
            }
        }

        if (p.innerHTML.trim() !== '' && isLessonConsideredComplete) {
            container.appendChild(p);
            replaceLucideIcons();
        }
    }


    function updateModuleProgressDisplay(moduleId) {
        const moduleData = courseData.find(m => m.moduleId === moduleId);
        if (!moduleData) return;

        const doneLessons = moduleData.lessons.filter(l => l.completed).length;
        const totalLessons = moduleData.lessons.length;
        const progress = totalLessons > 0 ? Math.round((doneLessons / totalLessons) * 100) : 0;

        const progressTextEl = document.getElementById(`progress-text-${moduleId}`);
        const progressBarEl = document.getElementById(`progress-bar-${moduleId}`);

        if (progressTextEl) {
            progressTextEl.textContent = `${progress}%`;
            if (progress === 0) {
                progressTextEl.classList.add('progress-empty');
            } else {
                progressTextEl.classList.remove('progress-empty');
            }
        }
        if (progressBarEl) {
            requestAnimationFrame(() => {
                progressBarEl.style.width = `${progress}%`;
            });
        }

        const linkEl = document.querySelector(`.sidebar-module-link[href="#module-${moduleId}"]`);
        if (linkEl) {
            if (progress === 100) {
                linkEl.classList.add('module-complete-visual');
            } else {
                linkEl.classList.remove('module-complete-visual');
            }
        }
    }

    function updateAllModuleProgressDisplays() {
        courseData.forEach(module => updateModuleProgressDisplay(module.moduleId));
    }

    function checkOverallCompletion() {
        const allDone = courseData.every(module =>
            module.lessons.every(lesson => lesson.completed)
        );
        if (allDone && completionSection) {
            completionSection.classList.remove('hidden');
            completionSection.scrollIntoView({ behavior: 'smooth' });
            completionSection.querySelectorAll('.lucide-party-popper, h2, p, button').forEach(el => {
                el.classList.add('animate-on-scroll', 'slide-up'); // Re-apply base class for animation
                // Clear previous is-visible to re-trigger if needed, or ensure it's applied
                el.classList.remove('is-visible');
                requestAnimationFrame(() => { // Use rAF for smoother application
                    el.classList.add('is-visible');
                });
            });
        }
    }

    function initializeApp() {
        loadSavedTheme();
        renderCourse(); // This will also call observeElements
        observeModuleSections();

        // Initial hero animation (already uses fadeInSlideUpInitial)
        // No need to manually add 'is-visible' if `animate-on-scroll` and IntersectionObserver handle it.
        // However, for elements *always* in view on load (like hero), direct animation or class might be desired.
        // The existing CSS with 'backwards' fill mode for animation should handle initial state.

        if (restartCourseButton) {
            restartCourseButton.onclick = () => {
                courseData.forEach(m => m.lessons.forEach(l => l.completed = false));
                if(completionSection) completionSection.classList.add('hidden');
                if(scrollContainer) scrollContainer.scrollTop = 0;

                // Re-render and re-initialize everything
                renderCourse(); // Will re-add elements and re-observe
                observeModuleSections(); // Re-observe module sections for active nav
                updateAllModuleProgressDisplays(); // Reset progress
                if (courseData.length > 0 && courseData[0].lessons.length > 0) {
                     updateActiveModuleNav(`module-${courseData[0].moduleId}`);
                } else {
                    updateActiveModuleNav('');
                }
                 // Ensure hero elements re-animate or become visible
                document.querySelectorAll('#hero-section .animate-on-scroll, #hero-section h2, #hero-section .hero-subtitle, #hero-section .scroll-down-indicator')
                    .forEach(el => {
                        el.classList.remove('is-visible'); // Remove to allow re-animation
                        animationObserver.unobserve(el); // Unobserve then re-observe
                        animationObserver.observe(el);
                    });
            };
        }
    }

    initializeApp();
});
</script>
</body>
</html>
