<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini Skills Booster - Immersive Scroll Experience</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/lucide-static@latest/dist/lucide.min.js"></script>

    <style>
        :root {
            --primary-bg: #05080A; /* Deepest space black */
            --secondary-bg: #0A0D12; 
            --tertiary-bg: #12161E;
            --accent-cyan: #00CFDE; 
            --accent-cyan-hover: #00F0FF;
            --accent-cyan-glow: rgba(0, 207, 222, 0.25);
            --accent-magenta: #F02D8E; 
            --accent-magenta-hover: #FF4AA1;
            --accent-magenta-glow: rgba(240, 45, 142, 0.2);
            --accent-green: #3EFF9A; 
            --accent-green-hover: #6BFFB8;
            --accent-red: #FF4F4F; 
            --accent-red-hover: #FF7272;
            --text-primary: #EAEFF5; 
            --text-secondary: #9BA9B8; 
            --text-interactive: var(--accent-cyan-hover);
            --border-color: #222831; 
            --card-shadow: rgba(0, 0, 0, 0.5);
            --aurora-1: var(--accent-cyan);
            --aurora-2: var(--accent-magenta);
            --aurora-3: #FFB300; /* Gold/Amber */
            --aurora-4: #7C4DFF; /* Deep Purple */
        }

        @keyframes animatedAuroraBackground {
            0% { background-position: 0% 0%; transform: scale(1); }
            25% { background-position: 100% 0%; transform: scale(1.05); }
            50% { background-position: 100% 100%; transform: scale(1); }
            75% { background-position: 0% 100%; transform: scale(1.05); }
            100% { background-position: 0% 0%; transform: scale(1); }
        }
        
        @keyframes textShine {
            0% { background-position: -200% center; }
            100% { background-position: 200% center; }
        }
        @keyframes subtleFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }
        @keyframes fadeInSlideUp {
            from { opacity: 0; transform: translateY(40px); }
            to { opacity: 1; transform: translateY(0); }
        }


        html {
            scroll-behavior: smooth;
        }
        body {
            font-family: 'Inter', sans-serif;
            background: var(--primary-bg);
            color: var(--text-primary);
            overflow-x: hidden; /* Prevent horizontal scroll */
            position: relative;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        body::before { 
            content: "";
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            width: 100%; height: 100%;
            background: 
                radial-gradient(ellipse at 15% 25%, var(--aurora-1), transparent 35%),
                radial-gradient(ellipse at 85% 35%, var(--aurora-2), transparent 45%),
                radial-gradient(ellipse at 35% 75%, var(--aurora-3), transparent 40%),
                radial-gradient(ellipse at 65% 85%, var(--aurora-4), transparent 50%);
            background-size: 300% 300%; 
            animation: animatedAuroraBackground 60s ease-in-out infinite; /* Slower, more complex */
            opacity: 0.06; 
            z-index: -1;
            pointer-events: none;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--tertiary-bg); border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--accent-cyan); }

        #app-wrapper { /* New main wrapper for layout */
            display: flex;
            height: 100vh; /* Full viewport height */
            overflow: hidden; /* Important: sidebar fixed, main scrolls */
        }

        #sticky-sidebar-nav {
            width: 280px; /* Fixed width for sidebar */
            flex-shrink: 0;
            background-color: rgba(8, 10, 14, 0.8); /* primary-bg with alpha */
            backdrop-filter: blur(20px) saturate(160%);
            -webkit-backdrop-filter: blur(20px) saturate(160%);
            border-right: 1px solid var(--border-color);
            padding: 2rem 1.5rem;
            overflow-y: auto; /* Scroll for sidebar content if needed */
            height: 100vh;
            position: fixed; /* Fixed position */
            top: 0; left: 0;
            z-index: 100;
        }
        #sidebar-header h1 {
            font-weight: 800;
            font-size: 1.5rem;
            letter-spacing: -0.03em;
            background: linear-gradient(90deg, var(--accent-cyan-hover), var(--accent-magenta));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
        }
        #sidebar-header p {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 2rem;
        }
        .sidebar-module-link {
            display: flex;
            align-items: center;
            padding: 0.8rem 1rem;
            border-radius: 0.6rem;
            color: var(--text-secondary);
            font-weight: 500;
            transition: all 0.25s ease;
            margin-bottom: 0.5rem;
            border: 1px solid transparent;
        }
        .sidebar-module-link .lucide {
            margin-right: 0.75rem;
            width: 20px; height: 20px;
            stroke-width: 2;
            transition: color 0.25s ease;
        }
        .sidebar-module-link:hover {
            background-color: var(--tertiary-bg);
            color: var(--text-primary);
            border-color: var(--border-color);
        }
        .sidebar-module-link.active {
            background: linear-gradient(90deg, var(--accent-cyan), var(--accent-magenta));
            color: white;
            font-weight: 600;
            box-shadow: 0 5px 15px var(--accent-cyan-glow);
        }
        .sidebar-module-link.active .lucide { color: white !important; }
        .sidebar-module-link .module-progress {
            margin-left: auto;
            font-size: 0.75rem;
            background-color: var(--tertiary-bg);
            padding: 0.1rem 0.4rem;
            border-radius: 0.25rem;
        }
        .sidebar-module-link.active .module-progress {
            background-color: rgba(255,255,255,0.2);
            color: white;
        }


        #scroll-container {
            flex-grow: 1;
            overflow-y: auto; /* This is where the scrolling happens */
            height: 100vh;
            padding-left: 280px; /* Offset for fixed sidebar */
        }

        .section-padding { padding: 6rem 4rem; } /* Standard padding for sections */
        @media (max-width: 768px) {
            .section-padding { padding: 4rem 1.5rem; }
            #sticky-sidebar-nav { width: 100%; height: auto; position: relative; border-right: none; border-bottom: 1px solid var(--border-color); }
            #scroll-container { padding-left: 0; }
            #app-wrapper { flex-direction: column; }
        }


        #hero-section {
            min-height: 90vh; /* Almost full viewport */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            position: relative;
        }
        #hero-section h2 {
            font-size: clamp(2.5rem, 8vw, 5.5rem); /* Responsive font size */
            font-weight: 900;
            letter-spacing: -0.05em;
            line-height: 1.1;
            margin-bottom: 1.5rem;
            background: linear-gradient(120deg, var(--accent-cyan-hover) 20%, var(--accent-magenta-hover) 60%, #FFD700 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: textShine 6s linear infinite, fadeInSlideUp 1s ease-out;
            background-size: 250% auto;
        }
        #hero-section .hero-subtitle {
            font-size: clamp(1rem, 3vw, 1.5rem);
            color: var(--text-secondary);
            max-width: 700px;
            margin-bottom: 2.5rem;
            line-height: 1.6;
            animation: fadeInSlideUp 1s ease-out 0.3s backwards;
        }
        #hero-section .scroll-down-indicator {
            position: absolute;
            bottom: 3rem;
            animation: subtleFloat 2s ease-in-out infinite, fadeInSlideUp 1s ease-out 0.6s backwards;
        }
        #hero-section .scroll-down-indicator .lucide {
            width: 30px; height: 30px;
            color: var(--accent-cyan);
        }

        .module-section {
            min-height: 100vh; /* Each module takes at least full viewport */
            border-bottom: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            justify-content: center; /* Vertically center content if less than 100vh */
        }
        .module-section:last-of-type {
            border-bottom: none;
        }
        .module-header {
            text-align: center;
            margin-bottom: 4rem;
            animation: fadeInSlideUp 0.8s ease-out backwards; /* Apply to all headers */
        }
        .module-header.is-visible { animation-play-state: running; }

        .module-title-main {
            font-size: clamp(2rem, 6vw, 4rem);
            font-weight: 800;
            letter-spacing: -0.03em;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }
        .module-description {
            font-size: 1.1rem;
            color: var(--text-secondary);
            max-width: 600px;
            margin: 0 auto 1rem auto;
        }

        .lesson-block {
            background-color: rgba(14, 18, 26, 0.5); /* secondary-bg with alpha */
            border: 1px solid var(--border-color);
            border-radius: 1rem;
            padding: 2rem 2.5rem;
            margin-bottom: 3rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            opacity: 0; /* For scroll animation */
            transform: translateY(30px);
            transition: opacity 0.6s ease-out, transform 0.6s ease-out;
        }
        .lesson-block.is-visible {
            opacity: 1;
            transform: translateY(0);
        }

        #lesson-title { /* This ID is used in JS, style it here */
            font-size: clamp(1.5rem, 4vw, 2.5rem);
            font-weight: 700;
            letter-spacing: -0.02em;
            color: var(--text-interactive);
            margin-bottom: 1.5rem;
        }
        #lesson-instruction { color: var(--text-secondary); line-height: 1.7; font-size: 1rem; }
        #lesson-instruction strong { color: var(--text-primary); font-weight: 600; }
        #lesson-instruction code {
            background-color: var(--tertiary-bg); color: var(--accent-cyan);
            padding: 0.25rem 0.5rem; border-radius: 0.4rem;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;
            border: 1px solid var(--border-color);
        }
        #lesson-instruction ul, #lesson-instruction ol { margin-left: 1.5rem; padding-left: 0.5rem; }
        #lesson-instruction ul li::marker { color: var(--accent-cyan); }

        #lesson-example {
            background-color: rgba(34, 40, 49, 0.3); /* border-color with alpha */
            border: 1px solid var(--border-color);
            padding: 1.5rem; border-radius: 0.75rem; margin-top: 1.5rem;
        }
        #lesson-example h4 { color: var(--text-primary); font-weight: 600; font-size: 1rem; }
        #lesson-example p { font-size: 0.9rem; }

        #quiz-area { border-top: 1px solid var(--border-color); margin-top: 2rem; padding-top: 2rem; }
        #quiz-question-title { color: var(--text-primary); font-weight: 700; font-size: 1.25rem; }
        #quiz-question { color: var(--text-primary); font-size: 1.1rem; font-weight: 500; margin-bottom: 1.5rem; }
        
        .lesson-option {
            background-color: var(--tertiary-bg);
            border: 2px solid var(--border-color);
            color: var(--text-primary);
            transition: all 0.25s ease;
            border-radius: 0.75rem; padding: 1rem 1.25rem; font-weight: 500;
        }
        .lesson-option:hover:not(:disabled) {
            background-color: var(--border-color); border-color: var(--accent-cyan);
            transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .lesson-option.correct {
            background: linear-gradient(135deg, var(--accent-green), var(--accent-green-hover)) !important;
            border-color: var(--accent-green-hover) !important; color: #002D15 !important; font-weight: 600;
        }
        .lesson-option.incorrect {
            background: linear-gradient(135deg, var(--accent-red), var(--accent-red-hover)) !important;
            border-color: var(--accent-red-hover) !important; color: #3E0000 !important; font-weight: 600;
        }
        #feedback-area p { font-weight: 500; padding: 0.75rem 1rem; border-radius: 0.5rem; }
        #feedback-area .feedback-correct { background-color: rgba(62, 255, 154, 0.15); color: var(--accent-green-hover); border: 1px solid var(--accent-green); }
        #feedback-area .feedback-incorrect { background-color: rgba(255, 79, 79, 0.15); color: var(--accent-red-hover); border: 1px solid var(--accent-red); }

        #next-lesson-button, #generate-image-button {
            background: linear-gradient(95deg, var(--accent-cyan), var(--accent-magenta));
            color: white; font-weight: 600; padding: 0.75rem 1.5rem; border-radius: 0.6rem;
            box-shadow: 0 4px 15px var(--accent-cyan-glow), 0 2px 8px var(--accent-magenta-glow);
            transition: all 0.25s ease; border: none;
        }
        #next-lesson-button:hover, #generate-image-button:hover {
            transform: translateY(-3px) scale(1.03);
            box-shadow: 0 7px 20px var(--accent-cyan-glow), 0 4px 12px var(--accent-magenta-glow);
        }
         #generate-image-button.generating { opacity:0.6; cursor: progress; }

        #visual-aid-section { margin-bottom: 2rem; }
        #visual-aid-container {
            background-color: rgba(14, 18, 26, 0.7); min-height: 300px;
            border-radius: 0.75rem; padding: 1.5rem;
            border: 1px dashed var(--border-color);
        }
        #visual-aid-container img { max-height: 450px; border-radius: 0.5rem; box-shadow: 0 5px 20px rgba(0,0,0,0.25); }
        .loading-spinner {
            border: 5px solid var(--tertiary-bg);
            border-top: 5px solid var(--accent-cyan);
            border-left: 5px solid var(--accent-magenta);
            width: 50px; height: 50px; animation: spin 0.6s linear infinite;
        }

        #completion-section {
            min-height: 80vh; display: flex; flex-direction: column;
            justify-content: center; align-items: center; text-align: center;
        }
        #completion-section h2 { font-size: 3rem; font-weight: 800; color: var(--accent-green-hover); }
        #completion-section p { font-size: 1.25rem; color: var(--text-secondary); margin-top: 0.5rem; }
        #completion-section .lucide-party-popper { width: 80px; height: 80px; color: var(--accent-cyan); margin-bottom: 1rem; animation: pop 0.5s ease-out forwards, tada 1.5s 0.5s ease-in-out infinite; }

        /* Utility for scroll animations */
        .animate-on-scroll {
            opacity: 0;
            transition: opacity 0.8s ease-out, transform 0.8s ease-out;
        }
        .animate-on-scroll.slide-up { transform: translateY(50px); }
        .animate-on-scroll.slide-left { transform: translateX(50px); }
        .animate-on-scroll.slide-right { transform: translateX(-50px); }
        .animate-on-scroll.is-visible {
            opacity: 1;
            transform: translateY(0) translateX(0);
        }

    </style>
</head>
<body>
    <div id="app-wrapper">
        <nav id="sticky-sidebar-nav">
            <div id="sidebar-header">
                <h1>Gemini Skills</h1>
                <p>Workspace Booster</p>
            </div>
            <ul id="module-navigation-list">
                <!-- Module links will be injected here by JS -->
            </ul>
        </nav>

        <main id="scroll-container">
            <section id="hero-section" class="section-padding">
                <h2>Unlock Your AI Potential<br/>with Gemini in Workspace.</h2>
                <p class="hero-subtitle">Master the tools that redefine productivity. Scroll to begin your journey into the future of work.</p>
                <div class="scroll-down-indicator">
                    <i data-lucide="arrow-down-circle"></i>
                </div>
            </section>

            <!-- Module and Lesson content will be injected here by JS -->

            <section id="completion-section" class="section-padding hidden">
                 <i data-lucide="party-popper"></i>
                <h2>Course Completed!</h2>
                <p>Congratulations! You've mastered the Gemini Workspace Skills Booster.</p>
                <button id="restart-course-button" class="mt-8 bg-sky-500 hover:bg-sky-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md transition duration-150 ease-in-out text-base">
                    Restart Course
                </button>
            </section>
        </main>
    </div>

<script>
// Ensure Lucide icons are replaced after DOM content is loaded
function replaceLucideIcons() {
    setTimeout(() => {
        if (typeof lucide !== 'undefined') {
            lucide.createIcons();
        } else {
            console.warn("Lucide library not loaded yet.");
            setTimeout(() => {
                if (typeof lucide !== 'undefined') { lucide.createIcons(); }
                 else { console.error("Lucide library failed to load."); }
            }, 500);
        }
    }, 50); 
}


document.addEventListener('DOMContentLoaded', () => {
    const courseData = [
        {
            moduleId: "gemini-fundamentals",
            moduleTitle: "Gemini in Workspace: Fundamentals",
            moduleDescription: "Understand the core concepts, capabilities, and responsible use of Gemini across your Google Workspace apps.",
            moduleIcon: "sparkles", // Lucide icon name
            lessons: [
                {
                    lessonId: "fundamentals-1",
                    title: "What is Gemini for Workspace?",
                    instruction: `<p>Gemini for Google Workspace is a powerful generative AI assistant integrated directly into apps like Gmail, Docs, Sheets, Slides, Meet, and Chat. It's designed to help you be more productive, creative, and efficient in your daily enterprise tasks.</p><p><strong>Key Capabilities:</strong></p><ul><li><strong>Content Generation:</strong> Draft emails, documents, presentations.</li><li><strong>Summarization:</strong> Condense long texts, email threads, or meeting transcripts.</li><li><strong>Brainstorming:</strong> Generate ideas for projects, campaigns, or problem-solving.</li><li><strong>Data Analysis (in Sheets):</strong> Help create formulas, analyze data, and build tables.</li><li><strong>Workflow Streamlining:</strong> Automate parts of your tasks by providing intelligent suggestions and actions.</li></ul><p>Gemini operates based on Google's AI Principles, emphasizing safety, fairness, and privacy, especially crucial in an enterprise environment.</p>`,
                    example: `Imagine you're a project manager. Gemini can help you draft a project kickoff email in Gmail, create a project plan outline in Docs, build a budget tracker in Sheets, and generate initial slide content for a project update in Slides.`,
                    quiz: {
                        question: "Which of the following is NOT a primary capability of Gemini in Google Workspace?",
                        options: [
                            "Generating draft documents and emails.",
                            "Summarizing long email threads.",
                            "Automatically managing your calendar appointments without input.",
                            "Helping brainstorm ideas for a marketing campaign."
                        ],
                        correctAnswer: "Automatically managing your calendar appointments without input."
                    },
                    completed: false
                },
                {
                    lessonId: "fundamentals-2",
                    title: "Accessing Gemini & Common UI",
                    instruction: `<p>Gemini features are surfaced contextually within each Workspace app. Look for these common indicators:</p><ul><li>✨ <strong>Sparkle icon:</strong> This is a frequent symbol for Gemini-powered features, often appearing on buttons or in toolbars.</li><li><strong>'Help me write/organize/visualize' buttons:</strong> These explicit action buttons invoke Gemini for specific tasks.</li><li><strong>Side panels/panes:</strong> Some apps might offer a dedicated Gemini panel for ongoing assistance.</li><li><strong>@-mentions:** In some contexts (e.g., Docs, Chat), typing <code>@gemini</code> followed by a prompt can trigger actions.</li></ul><p>Your enterprise administrator may also control the availability and specific rollout of Gemini features, so the exact UI might vary slightly.</p>`,
                    example: `In Google Docs, you might click a ✨ button to get help writing a paragraph. In Gmail, a 'Summarize' button with a sparkle icon might appear above a long email. In Sheets, you could type a request in a Gemini side panel to create a formula.`,
                    imagePrompt: "A sleek, modern user interface showing a prominent sparkle icon (✨) often associated with AI features in software. Minimalist design, perhaps on a button or next to a text field. Focus on the sparkle icon as a UI element. Photorealistic, high-detail, dramatic lighting.",
                    quiz: {
                        question: "What is a common visual cue for Gemini-powered features in Workspace apps?",
                        options: [
                            "A question mark icon.",
                            "A sparkle icon (✨).",
                            "A gear icon for settings.",
                            "A paperclip icon for attachments."
                        ],
                        correctAnswer: "A sparkle icon (✨)."
                    },
                    completed: false
                },
                // Add ALL other lessons for "gemini-fundamentals" here
            ]
        },
        {
            moduleId: "gemini-gmail",
            moduleTitle: "Gemini in Gmail: Email Mastery",
            moduleDescription: "Transform your email workflow with Gemini's intelligent assistance for drafting, summarizing, and managing communications.",
            moduleIcon: "mail",
            lessons: [
                {
                    lessonId: "gmail-1",
                    title: "Drafting Emails with 'Help me write'",
                    instruction: `<p>The 'Help me write' feature in Gmail, powered by Gemini, can significantly speed up your email composition. Provide a prompt, and Gemini generates a draft.</p><p><strong>How to use it:</strong></p><ol><li>Click the 'Help me write' (often with a ✨ icon) button when composing a new email or reply.</li><li>Type your prompt in the input field. Be clear about the purpose, recipient, and key information.</li><li>Gemini will generate a draft. You can then:<ul><li><strong>Insert:</strong> Add the draft to your email.</li><li><strong>Recreate:</strong> Ask Gemini to try again, perhaps with a refined prompt.</li><li><strong>Refine:</strong> Use options like 'Formalize,' 'Elaborate,' 'Shorten,' or 'Summarize' to adjust the draft. You can also provide custom refinement prompts.</li></ul></li></ol><p>Always review and edit the draft for accuracy, tone, and completeness before sending.</p>`,
                    example: `Prompt for 'Help me write': 'Draft an email to the project team (cc manager@example.com) congratulating them on launching Project Phoenix successfully. Mention their hard work and the positive client feedback received. Ask them to prepare for a post-launch review meeting next week.'`,
                    imagePrompt: "A mock Gmail compose window with a highlighted 'Help me write ✨' button. A text bubble shows an example prompt being entered. Clean, illustrative, professional, with subtle depth, shadows, and a modern aesthetic.",
                    quiz: {
                        question: "After Gemini generates an email draft in Gmail, what can you typically NOT do directly with the refinement options?",
                        options: [
                            "Make the draft more formal.",
                            "Shorten the draft.",
                            "Automatically send the email without review.",
                            "Ask Gemini to elaborate on a point."
                        ],
                        correctAnswer: "Automatically send the email without review."
                    },
                    completed: false
                },
                // Add ALL other lessons for "gemini-gmail" here
            ]
        },
        // ... (Include ALL other modules: Docs, Sheets, Slides, Prompting, Workflows, Future, with their lessons)
        // Make sure to add moduleDescription and moduleIcon for each module.
        {
            moduleId: "gemini-slides",
            moduleTitle: "Gemini in Slides: Presentation Power-Up",
            moduleDescription: "Create stunning presentations faster with AI-generated outlines, content, and even custom images.",
            moduleIcon: "presentation",
            lessons: [
                {
                    lessonId: "slides-2",
                    title: "Creating Images with 'Help me visualize'",
                    instruction: `<p>A standout feature of Gemini in Slides is its ability to generate original images based on your text descriptions using 'Help me visualize' (or similar prompts). This allows you to create custom visuals that perfectly match your content.</p><p><strong>How to use it:</strong></p><ol><li>When you need an image, invoke Gemini's image generation feature.</li><li>Provide a descriptive prompt for the image you want. Be specific about the subject, style, colors, and mood. Examples:<ul><li>'Create an image of a diverse team collaborating in a modern office, in a photorealistic style.'</li><li>'Generate an abstract background with blue and green flowing lines.'</li><li>'A cartoon drawing of a lightbulb turning on above a computer.'</li></ul></li><li>Gemini will offer several image options. Select the one you like, or refine your prompt to get different results.</li><li>You can then insert the image into your slide.</li></ol><p>This is incredibly powerful for making your presentations unique and engaging, without needing separate graphic design tools for simple visuals.</p>`,
                    example: `For a slide about 'Innovation,' you prompt Gemini: 'Create an image representing innovation, perhaps a stylized gear turning into a glowing brain, with a futuristic feel.' Gemini generates a few options for you to choose from.`,
                    imagePrompt: "A stylized image representing AI generating a picture. Perhaps a robotic hand painting on a digital canvas, or abstract shapes forming into a recognizable image. Theme: creativity and technology. Cinematic lighting, high dynamic range, and a touch of surrealism.",
                    quiz: {
                        question: "What unique capability does Gemini offer in Google Slides for enhancing visual appeal?",
                        options: [
                            "Advanced video editing tools.",
                            "Generating original images based on text descriptions.",
                            "A library of 3D models to insert.",
                            "Automated animation of all slide elements."
                        ],
                        correctAnswer: "Generating original images based on text descriptions."
                    },
                    completed: false
                },
            ]
        }
    ];

    const scrollContainer = document.getElementById('scroll-container');
    const moduleNavList = document.getElementById('module-navigation-list');
    const completionSection = document.getElementById('completion-section');
    const restartCourseButton = document.getElementById('restart-course-button');

    let currentLessonDOM = null; // To keep track of the currently "active" lesson for quiz handling

    // --- Animation Observer ---
    const animationObserver = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('is-visible');
                // observer.unobserve(entry.target); // Optional: unobserve after animation
            } else {
                 // Optional: remove is-visible if you want animations to replay on scroll back
                 // entry.target.classList.remove('is-visible');
            }
        });
    }, { threshold: 0.1 }); // Adjust threshold as needed

    function observeElements(selector) {
        document.querySelectorAll(selector).forEach(el => {
            animationObserver.observe(el);
        });
    }
    
    // --- IMAGE GENERATION --- (Same as previous version, ensure it's included)
    async function generateAndDisplayImage(prompt, container) {
        if (!container) return;
        const generateButton = container.parentNode.querySelector('.generate-image-button-lesson');

        container.innerHTML = '<div class="loading-spinner"></div> <p class="text-slate-400 text-sm mt-4">Crafting your visual...</p>';
        if(generateButton) generateButton.disabled = true;


        try {
            const payload = { instances: [{ prompt: prompt }], parameters: { "sampleCount": 1 } };
            const apiKey = ""; // API Key will be injected by the environment
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-002:predict?key=${apiKey}`;
            
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(`API request failed: ${errorData.error?.message || response.statusText || 'Unknown error'}`);
            }
            
            const result = await response.json();

            if (result.predictions && result.predictions.length > 0 && result.predictions[0].bytesBase64Encoded) {
                const imageUrl = `data:image/png;base64,${result.predictions[0].bytesBase64Encoded}`;
                container.innerHTML = `<img src="${imageUrl}" alt="Generated visual aid" class="opacity-0 transition-opacity duration-700 ease-in-out">`;
                setTimeout(() => {
                    const imgElement = container.querySelector('img');
                    if (imgElement) {
                        imgElement.classList.remove('opacity-0');
                        imgElement.classList.add('opacity-100');
                    }
                }, 100);
            } else {
                throw new Error('No image data in response.');
            }
        } catch (error) {
            console.error('Error generating image:', error);
            container.innerHTML = `<p class="text-red-400 text-sm p-4">Image generation failed. <br><span class="text-xs text-slate-500">${error.message}</span></p>`;
        } finally {
            if(generateButton) generateButton.disabled = false;
        }
    }


    // --- UI RENDERING ---
    function renderCourse() {
        moduleNavList.innerHTML = '';
        // Clear existing modules from scrollContainer, except hero and completion
        Array.from(scrollContainer.querySelectorAll('.module-section')).forEach(el => el.remove());

        courseData.forEach((module, moduleIdx) => {
            // Create Sidebar Link
            const li = document.createElement('li');
            const link = document.createElement('a');
            link.href = `#module-${module.moduleId}`;
            link.className = 'sidebar-module-link';
            link.innerHTML = `
                <i data-lucide="${module.moduleIcon || 'book-open'}"></i>
                <span>${module.moduleTitle}</span>
                <span class="module-progress" id="progress-${module.moduleId}">0%</span>
            `;
            link.addEventListener('click', (e) => {
                e.preventDefault();
                document.querySelector(link.getAttribute('href')).scrollIntoView({ behavior: 'smooth' });
                updateActiveModuleNav(module.moduleId);
            });
            li.appendChild(link);
            moduleNavList.appendChild(li);

            // Create Module Section
            const moduleSection = document.createElement('section');
            moduleSection.id = `module-${module.moduleId}`;
            moduleSection.className = 'module-section section-padding animate-on-scroll slide-up';
            
            let moduleHTML = `
                <div class="module-header animate-on-scroll slide-up">
                    <h3 class="module-title-main">${module.moduleTitle}</h3>
                    <p class="module-description">${module.moduleDescription || ''}</p>
                </div>
            `;

            module.lessons.forEach((lesson, lessonIdx) => {
                moduleHTML += `
                    <div class="lesson-block" data-module-index="${moduleIdx}" data-lesson-index="${lessonIdx}">
                        <h4 id="lesson-title">${lesson.title}</h4>
                        
                        ${lesson.imagePrompt ? `
                        <div id="visual-aid-section" class="mb-6">
                            <div class="visual-aid-container-lesson my-4 min-h-[200px] flex justify-center items-center text-center bg-black bg-opacity-20 rounded-md p-4 border border-dashed border-gray-700">
                                <p class="text-slate-400 text-sm">Click button to generate visual.</p>
                            </div>
                            <button class="generate-image-button-lesson mt-3 flex items-center justify-center w-full sm:w-auto mx-auto text-sm bg-cyan-600 hover:bg-cyan-500 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition">
                                <i data-lucide="image-plus" class="mr-2 h-4 w-4"></i> Generate Visual Aid
                            </button>
                        </div>` : ''}

                        <div id="lesson-instruction" class="prose prose-invert max-w-none mb-6">${lesson.instruction}</div>
                        <div id="lesson-example" class="p-4 rounded-lg mb-6">
                            <h5 class="font-semibold text-sm mb-2 flex items-center"><i data-lucide="lightbulb" class="mr-2 h-4 w-4 text-yellow-400"></i>Example:</h5>
                            <p class="text-xs">${lesson.example}</p>
                        </div>
                        <div id="quiz-area" class="mt-6 pt-4 border-t border-gray-700">
                            <h5 id="quiz-question-title" class="text-md font-semibold mb-3 flex items-center"><i data-lucide="help-circle" class="mr-2 h-5 w-5 text-cyan-400"></i>Test Your Knowledge:</h5>
                            <p id="quiz-question" class="mb-4">${lesson.quiz.question}</p>
                            <div class="quiz-options-lesson grid grid-cols-1 sm:grid-cols-2 gap-3">
                                ${lesson.quiz.options.map(opt => `<button class="lesson-option">${opt}</button>`).join('')}
                            </div>
                            <div class="feedback-area-lesson mt-4">
                                <p class="feedback-message-lesson text-xs p-2 rounded-md"></p>
                            </div>
                        </div>
                        <div class="next-lesson-button-container mt-6 text-right">
                             <!-- Next button will be added if quiz is passed or no quiz -->
                        </div>
                    </div>
                `;
            });
            moduleSection.innerHTML = moduleHTML;
            // Insert before the completion section
            scrollContainer.insertBefore(moduleSection, completionSection);
        });

        addEventListenersToLessons();
        updateAllModuleProgressDisplays();
        replaceLucideIcons();
        observeElements('.animate-on-scroll, .lesson-block, .module-header'); // Observe new elements
    }
    
    function updateActiveModuleNav(visibleModuleId) {
        document.querySelectorAll('.sidebar-module-link').forEach(link => {
            if (link.getAttribute('href') === `#${visibleModuleId}`) {
                link.classList.add('active');
            } else {
                link.classList.remove('active');
            }
        });
    }

    // --- Intersection Observer for active module highlighting ---
    const moduleObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                updateActiveModuleNav(entry.target.id);
            }
        });
    }, { root: scrollContainer, threshold: 0.5 }); // Adjust threshold

    function observeModuleSections() {
        document.querySelectorAll('.module-section').forEach(section => {
            moduleObserver.observe(section);
        });
    }


    function addEventListenersToLessons() {
        document.querySelectorAll('.lesson-block').forEach(lessonBlock => {
            const moduleIndex = parseInt(lessonBlock.dataset.moduleIndex);
            const lessonIndex = parseInt(lessonBlock.dataset.lessonIndex);
            const lesson = courseData[moduleIndex].lessons[lessonIndex];

            // Image Generation Button
            const imageGenButton = lessonBlock.querySelector('.generate-image-button-lesson');
            if (imageGenButton && lesson.imagePrompt) {
                const visualContainer = lessonBlock.querySelector('.visual-aid-container-lesson');
                imageGenButton.onclick = () => generateAndDisplayImage(lesson.imagePrompt, visualContainer);
            }

            // Quiz Options
            const quizOptionsContainer = lessonBlock.querySelector('.quiz-options-lesson');
            const optionButtons = quizOptionsContainer.querySelectorAll('.lesson-option');
            const feedbackMessageEl = lessonBlock.querySelector('.feedback-message-lesson');
            const nextButtonContainer = lessonBlock.querySelector('.next-lesson-button-container');

            optionButtons.forEach(button => {
                button.onclick = () => {
                    handleQuizOptionSelect(button, button.textContent, lesson, optionButtons, feedbackMessageEl, nextButtonContainer, moduleIndex, lessonIndex);
                };
            });

            // If lesson is already completed or has no quiz, show next button or completion
            if (lesson.completed || !lesson.quiz) {
                 showNextOrComplete(nextButtonContainer, moduleIndex, lessonIndex);
            }
        });
    }

    function handleQuizOptionSelect(selectedButtonEl, selectedAnswer, lesson, allOptionButtons, feedbackEl, nextBtnContainer, moduleIdx, lessonIdx) {
        allOptionButtons.forEach(btn => btn.disabled = true);

        if (selectedAnswer === lesson.quiz.correctAnswer) {
            feedbackEl.innerHTML = '<strong>Correct!</strong> Well done.';
            feedbackEl.className = 'feedback-message-lesson text-xs p-2 rounded-md feedback-correct';
            selectedButtonEl.classList.add('correct');
            lesson.completed = true;
            updateModuleProgressDisplay(lesson.moduleId || courseData[moduleIdx].moduleId); // Use actual moduleId if available
        } else {
            feedbackEl.innerHTML = `<strong>Not quite.</strong> Correct: "<em>${lesson.quiz.correctAnswer}</em>".`;
            feedbackEl.className = 'feedback-message-lesson text-xs p-2 rounded-md feedback-incorrect';
            selectedButtonEl.classList.add('incorrect');
            allOptionButtons.forEach(btn => {
                if (btn.textContent === lesson.quiz.correctAnswer) {
                    btn.classList.add('correct');
                }
            });
        }
        showNextOrComplete(nextBtnContainer, moduleIdx, lessonIdx);
        updateModuleProgressDisplay(courseData[moduleIdx].moduleId);
    }
    
    function showNextOrComplete(container, currentModuleIdx, currentLessonIdx) {
        container.innerHTML = ''; // Clear previous button
        const isLastLessonInModule = currentLessonIdx === courseData[currentModuleIdx].lessons.length - 1;
        const isLastModuleInCourse = currentModuleIdx === courseData.length - 1;

        if (isLastLessonInModule && isLastModuleInCourse) {
            // Potentially scroll to completion section or show a special message
            // For now, just indicate module completion
            const p = document.createElement('p');
            p.className = 'text-green-400 font-semibold mt-4';
            p.textContent = 'Module Completed! Scroll to next or finish.';
            container.appendChild(p);
            checkOverallCompletion();

        } else if (isLastLessonInModule) {
            const p = document.createElement('p');
            p.className = 'text-green-400 font-semibold mt-4';
            p.textContent = 'Module Completed! Scroll to the next module.';
            container.appendChild(p);
        } else {
            // This would be for "next lesson within module" if we had that button per lesson
            // For now, user scrolls to next lesson block.
            // We can add a small "Lesson Complete!" message
            const p = document.createElement('p');
            p.className = 'text-green-400 font-semibold mt-4 text-sm';
            p.innerHTML = 'Lesson Complete! <i data-lucide="check-circle" class="inline w-4 h-4"></i> Scroll down for the next one.';
            container.appendChild(p);
            replaceLucideIcons();
        }
    }

    function updateModuleProgressDisplay(moduleId) {
        const moduleData = courseData.find(m => m.moduleId === moduleId);
        if (!moduleData) return;

        const completedLessons = moduleData.lessons.filter(l => l.completed).length;
        const totalLessons = moduleData.lessons.length;
        const progress = totalLessons > 0 ? Math.round((completedLessons / totalLessons) * 100) : 0;
        
        const progressEl = document.getElementById(`progress-${moduleId}`);
        if (progressEl) {
            progressEl.textContent = `${progress}%`;
        }
    }
    function updateAllModuleProgressDisplays() {
        courseData.forEach(module => updateModuleProgressDisplay(module.moduleId));
    }

    function checkOverallCompletion() {
        const allDone = courseData.every(module => module.lessons.every(lesson => lesson.completed));
        if (allDone) {
            completionSection.classList.remove('hidden');
            completionSection.scrollIntoView({ behavior: 'smooth' });
        }
    }

    function initializeApp() {
        renderCourse();
        observeModuleSections(); // For sidebar active state
        replaceLucideIcons(); // Initial icon rendering
        
        // Add animation to hero elements after a slight delay
        setTimeout(() => {
            document.querySelector('#hero-section h2')?.classList.add('is-visible');
            document.querySelector('#hero-section .hero-subtitle')?.classList.add('is-visible');
            document.querySelector('#hero-section .scroll-down-indicator')?.classList.add('is-visible');
        }, 100);

        if (restartCourseButton) {
            restartCourseButton.onclick = () => {
                courseData.forEach(m => m.lessons.forEach(l => l.completed = false));
                completionSection.classList.add('hidden');
                scrollContainer.scrollTop = 0; // Scroll to top
                renderCourse(); // Re-render to reset UI elements like quiz states
                observeModuleSections();
                updateActiveModuleNav(''); // Clear active nav
            };
        }
    }
    
    initializeApp();
});
</script>
</body>
</html>
